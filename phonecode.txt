<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GSO Phone Simulator ‚Äì Dev Edition</title>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&display=swap');

    :root {
        --anim-speed: 0.25s;
        --android-blue: #1a73e8;
        --android-surface: #101114;
        --wallpaper-image: url('wallpaper-ocean.svg');
        --theme-accent: #1a73e8;
        --theme-accent-2: #4ea1ff;
    }

    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: "Google Sans", "Segoe UI", Roboto, Arial, sans-serif;
    }

    body {
        background: radial-gradient(circle at top, #1d2430 0, #0a0d13 65%);
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #fff;
    }

    body.dark-mode {
        background: radial-gradient(circle at top, #0f1117 0, #05070b 65%);
    }

    body.dark-mode .phone-screen {
        filter: saturate(0.9) brightness(0.85);
    }


    body.one-ui .phone-screen {
        background-image: linear-gradient(180deg, rgba(238,243,255,0.82) 0%, rgba(219,230,255,0.74) 52%, rgba(210,220,251,0.7) 100%), var(--wallpaper-image);
        background-size: cover;
        background-position: center;
        color: #111;
    }

    body.one-ui .widget,
    body.one-ui .dock,
    body.one-ui .list-item,
    body.one-ui .store-card,
    body.one-ui .app-header,
    body.one-ui .app-screen {
        background: rgba(255,255,255,0.78);
        color: #111;
        border-color: rgba(17,17,17,0.12);
    }

    body.one-ui .app-body,
    body.one-ui .sleep-hint,
    body.one-ui .store-card-sub,
    body.one-ui .list-item-sub {
        color: #222;
        opacity: 0.85;
    }



    body.one-ui[data-galaxy-theme="purple"] .phone-screen {
        background: linear-gradient(180deg, #f3ecff 0%, #e6d8ff 55%, #d9cbff 100%);
    }

    body.one-ui[data-galaxy-theme="dark"] .phone-screen {
        background: linear-gradient(180deg, #1d2430 0%, #151a22 55%, #0f141c 100%);
        color: #ecf2ff;
    }

    body.one-ui[data-galaxy-theme="dark"] .widget,
    body.one-ui[data-galaxy-theme="dark"] .dock,
    body.one-ui[data-galaxy-theme="dark"] .list-item,
    body.one-ui[data-galaxy-theme="dark"] .store-card,
    body.one-ui[data-galaxy-theme="dark"] .app-header,
    body.one-ui[data-galaxy-theme="dark"] .app-screen {
        background: rgba(21, 28, 38, 0.82);
        color: #eaf1ff;
        border-color: rgba(255,255,255,0.12);
    }

    body.one-ui[data-galaxy-theme="dark"] .list-item-sub,
    body.one-ui[data-galaxy-theme="dark"] .sleep-hint,
    body.one-ui[data-galaxy-theme="dark"] .store-card-sub {
        color: #d6e3ff;
        opacity: 0.9;
    }

    @keyframes virusBlink {
        0%, 100% { opacity: 0.55; }
        50% { opacity: 1; }
    }

    .phone-frame {
        position: relative;
        width: 380px;
        height: 720px;
        border-radius: 28px;
        background: #161a22;
        box-shadow: 0 0 0 6px #0a0a0a, 0 22px 60px rgba(0,0,0,0.8);
        overflow: visible;
        border: 2px solid #2f3542;
    }

    .phone-screen {
        position: absolute;
        inset: 10px;
        border-radius: 20px;
        overflow: hidden;
        background-image: linear-gradient(to bottom, rgba(0,0,0,0.22), rgba(0,0,0,0.38)), var(--wallpaper-image);
        background-size: cover;
        background-position: center;
        display: flex;
        flex-direction: column;
        transition: filter var(--anim-speed) ease, transform var(--anim-speed) ease, box-shadow var(--anim-speed) ease;
        transform-origin: center;
    }

    .phone-screen.awake {
        transform: scale(1);
    }

    .phone-screen.sleeping {
        transform: scale(0.98);
        filter: brightness(0.4);
    }

    .phone-screen.dev-slow {
        transition-duration: 0.6s;
    }

    .phone-screen.dev-flash {
        box-shadow: 0 0 0 2px rgba(0,255,0,0.7);
    }

    .side-button {
        position: absolute;
        width: 8px;
        height: 74px;
        background: linear-gradient(to bottom, #5f6b7d, #303745);
        border-radius: 8px;
        cursor: pointer;
        transition: transform 0.15s ease, background 0.15s ease;
        box-shadow: 0 1px 6px rgba(0,0,0,0.45);
    }

    .side-button::before {
        position: absolute;
        left: 14px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 9px;
        color: rgba(255,255,255,0.62);
        letter-spacing: 0.08em;
        text-transform: uppercase;
        pointer-events: none;
    }

    .side-button:active {
        transform: scale(0.95);
        background: #555;
    }

    .side-button.power {
        right: -8px;
        top: 190px;
        height: 86px;
    }

    .side-button.power::before {
        content: "Power";
        left: -46px;
    }

    .side-button.vol-up {
        left: -8px;
        top: 178px;
    }

    .side-button.vol-up::before {
        content: "Vol +";
    }

    .side-button.vol-down {
        left: -8px;
        top: 264px;
    }

    .side-button.vol-down::before {
        content: "Vol -";
    }

    .status-bar {
        height: 30px;
        padding: 6px 12px 0 12px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        color: #eee;
        font-size: 11px;
        background: linear-gradient(to bottom, rgba(0,0,0,0.56), rgba(0,0,0,0.12));
        z-index: 10;
        position: relative;
        cursor: pointer;
        transition: background 0.2s ease;
    }

    .status-bar:hover {
        background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
    }

    .status-left, .status-right {
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .status-center {
        font-weight: 600;
        letter-spacing: 0.04em;
    }

    .icon-signal, .icon-wifi, .icon-battery {
        width: 14px;
        height: 8px;
        border-radius: 2px;
        border: 1px solid #ccc;
        position: relative;
    }

    .icon-battery::after {
        content: "";
        position: absolute;
        right: -3px;
        top: 2px;
        width: 2px;
        height: 4px;
        background: #ccc;
        border-radius: 1px;
    }

    .battery-level {
        position: absolute;
        inset: 1px;
        background: #4caf50;
        border-radius: 1px;
        transition: width var(--anim-speed) ease;
    }

    .wifi-dot, .signal-bar {
        position: absolute;
        bottom: 1px;
        left: 2px;
        right: 2px;
        top: 1px;
        border-radius: 1px;
        background: linear-gradient(to right, #ccc 0, #ccc 60%, transparent 60%);
        opacity: 0.8;
    }

    .dropdown-shade {
        position: absolute;
        top: -260px;
        left: 0;
        right: 0;
        height: 260px;
        background: rgba(10,10,20,0.96);
        backdrop-filter: blur(18px);
        border-bottom-left-radius: 24px;
        border-bottom-right-radius: 24px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.7);
        padding: 12px 14px 16px;
        transition: top var(--anim-speed) ease-out, opacity var(--anim-speed) ease-out;
        z-index: 15;
        font-size: 12px;
        opacity: 0;
    }

    .dropdown-shade.visible {
        top: 0;
        opacity: 1;
    }

    .shade-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
    }

    .shade-title {
        font-weight: 600;
        font-size: 13px;
    }

    .shade-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
        margin-bottom: 10px;
    }

    .shade-tile {
        background: rgba(255,255,255,0.04);
        border-radius: 10px;
        padding: 6px 4px;
        text-align: center;
        cursor: pointer;
        border: 1px solid transparent;
        user-select: none;
        transition: background 0.18s ease, border-color 0.18s ease, transform 0.12s ease;
    }

    .shade-tile:active {
        transform: scale(0.96);
    }

    .shade-tile.active {
        background: rgba(76,175,80,0.18);
        border-color: rgba(76,175,80,0.7);
    }

    .shade-tile-label {
        font-size: 10px;
        margin-top: 4px;
        opacity: 0.9;
    }

    .shade-slider-row {
        margin-top: 4px;
    }

    .shade-slider-label {
        font-size: 11px;
        margin-bottom: 2px;
        opacity: 0.9;
    }

    .shade-slider {
        width: 100%;
    }

    .content {
        flex: 1;
        position: relative;
        overflow: hidden;
    }

    .lock-screen, .home-screen, .app-screen, .boot-screen, .shutdown-screen, .sleep-overlay {
        position: absolute;
        inset: 0;
        display: none;
        opacity: 0;
        transform: translateY(10px);
        transition: opacity var(--anim-speed) ease, transform var(--anim-speed) ease;
    }

    .lock-screen.active,
    .home-screen.active,
    .app-screen.active,
    .boot-screen.active,
    .shutdown-screen.active,
    .sleep-overlay.active {
        display: flex;
        opacity: 1;
        transform: translateY(0);
    }

    .lock-screen {
        background: radial-gradient(circle at top, #1b3b6a, #02030a 60%, #000);
        color: #fff;
        flex-direction: column;
        align-items: center;
        justify-content: space-between;
        padding: 40px 20px 60px;
    }

    .lock-time {
        font-size: 52px;
        font-weight: 300;
        transition: opacity var(--anim-speed) ease, transform var(--anim-speed) ease;
    }

    .lock-date {
        font-size: 14px;
        opacity: 0.8;
        margin-top: 4px;
    }

    .lock-notifications {
        width: 100%;
        max-height: 220px;
        overflow-y: auto;
        margin-top: 20px;
    }

    .notif-card {
        background: rgba(0,0,0,0.45);
        border-radius: 14px;
        padding: 8px 10px;
        margin-bottom: 8px;
        font-size: 12px;
        animation: fadeInUp var(--anim-speed) ease;
    }

    .notif-title {
        font-weight: 600;
        margin-bottom: 2px;
    }

    .notif-body {
        opacity: 0.9;
    }

    .lock-footer {
        text-align: center;
        font-size: 12px;
        opacity: 0.8;
    }

    .lock-pin {
        margin-top: 16px;
        text-align: center;
        width: 100%;
    }

    .lock-auth-panel {
        margin-top: 10px;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .lock-auth-panel.hidden {
        display: none;
    }

    .lock-unlock-btn {
        border: 1px solid rgba(255,255,255,0.35);
        background: rgba(255,255,255,0.08);
        color: #fff;
        border-radius: 999px;
        padding: 8px 18px;
        cursor: pointer;
        font-size: 13px;
    }

    .lock-swipe-hint {
        margin-top: 8px;
        opacity: 0.75;
        font-size: 11px;
    }

    .pin-dots {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin-bottom: 8px;
    }

    .pin-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        border: 1px solid rgba(255,255,255,0.7);
        transition: background 0.15s ease, transform 0.15s ease;
    }

    .pin-dot.filled {
        background: #fff;
        transform: scale(1.1);
    }

    .pin-pad {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
        margin-top: 8px;
    }

    .pin-entry-panel.hidden {
        display: none;
    }

    .pin-key {
        padding: 8px 0;
        border-radius: 999px;
        background: rgba(0,0,0,0.4);
        border: 1px solid rgba(255,255,255,0.1);
        cursor: pointer;
        font-size: 16px;
        user-select: none;
        transition: background 0.15s ease, transform 0.12s ease;
    }

    .pin-key:active {
        background: rgba(255,255,255,0.1);
        transform: scale(0.96);
    }

    .pin-key span {
        display: block;
        color: #f5f8ff;
    }

    .lock-action-btn {
        margin-top: 10px;
        border: 1px solid rgba(255,255,255,0.28);
        border-radius: 999px;
        background: rgba(255,255,255,0.08);
        color: #f2f6ff;
        padding: 7px 14px;
        font-size: 12px;
        cursor: pointer;
    }

    .home-screen {
        padding: 40px 16px 16px;
        flex-direction: column;
        justify-content: space-between;
    }

    .widget-row {
        display: flex;
        gap: 10px;
        margin-bottom: 16px;
    }

    .widget {
        flex: 1;
        background: rgba(0,0,0,0.45);
        border-radius: 18px;
        padding: 10px;
        font-size: 11px;
        transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
    }

    .widget:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(0,0,0,0.5);
        background: rgba(0,0,0,0.6);
    }

    .widget-title {
        font-size: 11px;
        opacity: 0.8;
        margin-bottom: 4px;
    }

    .widget-main {
        font-size: 18px;
        font-weight: 500;
    }

    .widget-sub {
        font-size: 11px;
        opacity: 0.8;
        margin-top: 2px;
    }

    .dock {
        display: flex;
        justify-content: space-around;
        padding: 8px 10px;
        background: rgba(0,0,0,0.5);
        border-radius: 18px;
        margin-top: 10px;
        backdrop-filter: blur(10px);
        transition: background 0.2s ease;
    }

    .dock:hover {
        background: rgba(0,0,0,0.7);
    }

    .app-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
        margin-top: 10px;
        min-height: 172px;
    }

    .app-pager {
        display: flex;
        justify-content: center;
        gap: 6px;
        margin-top: 8px;
    }

    .pager-dot {
        width: 7px;
        height: 7px;
        border-radius: 999px;
        background: rgba(255,255,255,0.35);
        border: none;
        cursor: pointer;
        transition: transform 0.15s ease, background 0.15s ease;
    }

    .pager-dot.active {
        background: #fff;
        transform: scale(1.15);
    }

    .app-icon {
        text-align: center;
        font-size: 11px;
        cursor: pointer;
        user-select: none;
        transition: transform 0.15s ease, opacity 0.15s ease;
    }

    .app-icon:hover {
        transform: translateY(-2px);
    }

    .app-icon[draggable="true"] {
        cursor: grab;
    }

    .app-icon.drag-over {
        outline: 2px dashed rgba(255,255,255,0.6);
        border-radius: 16px;
    }

    .app-icon-circle {
        width: 46px;
        height: 46px;
        border-radius: 16px;
        margin: 0 auto 4px;
        background: linear-gradient(135deg, #4a90e2, #9013fe);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        font-weight: 700;
        box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    .app-icon-circle span {
        line-height: 1;
    }

    .app-icon:hover .app-icon-circle {
        transform: translateY(-1px) scale(1.03);
        box-shadow: 0 6px 14px rgba(0,0,0,0.6);
    }

    .app-icon-circle.system {
        background: linear-gradient(135deg, #4caf50, #2e7d32);
    }

    .app-icon-circle.store {
        background: linear-gradient(135deg, #ff9800, #f44336);
    }

    .app-icon-circle.media {
        background: linear-gradient(135deg, #e91e63, #9c27b0);
    }

    .app-icon-circle.tools {
        background: linear-gradient(135deg, #009688, #00bcd4);
    }



    body.one-ui .btn-secondary {
        background: rgba(17,17,17,0.1);
        color: #111;
        box-shadow: 0 6px 14px rgba(0,0,0,0.16);
    }

    body.one-ui .btn-primary {
        color: #fff;
    }

    .app-icon-circle.brand-chrome { background: conic-gradient(#ea4335 0 25%, #fbbc05 25% 50%, #34a853 50% 75%, #4285f4 75% 100%); }
    .app-icon-circle.brand-gmail { background: linear-gradient(135deg, #ffffff, #f1f3f4); color:#d93025; border:1px solid rgba(0,0,0,0.08); }
    .app-icon-circle.brand-drive { background: linear-gradient(135deg, #0f9d58, #f4b400 55%, #4285f4); }
    .app-icon-circle.brand-maps { background: linear-gradient(135deg, #34a853, #4285f4); }
    .app-icon-circle.brand-play { background: linear-gradient(135deg, #00c6ff, #1a73e8); }
    .app-icon-circle.brand-s-health,
    .app-icon-circle.brand-s-internet,
    .app-icon-circle.brand-s-notes,
    .app-icon-circle.brand-oneui { background: linear-gradient(135deg, #1669ff, #5e9bff); }
    .app-icon-circle.brand-miui { background: linear-gradient(135deg, #ff7a00, #ffb300); }

    body.color-ui .app-icon-circle {
        background: linear-gradient(135deg, var(--theme-accent), var(--theme-accent-2)) !important;
        color: #fff;
        border: none;
    }

    body.color-ui .widget,
    body.color-ui .dock,
    body.color-ui .list-item,
    body.color-ui .store-card,
    body.color-ui .app-header,
    body.color-ui .app-screen,
    body.color-ui .settings-row {
        border-color: var(--theme-accent);
    }

    body.color-ui .btn-secondary,
    body.color-ui .store-btn,
    body.color-ui .pill {
        border-color: var(--theme-accent);
    }

    body.color-ui .toggle.on,
    body.color-ui .store-btn,
    body.color-ui .btn-primary {
        background: var(--theme-accent);
    }

    .app-screen {
        background: rgba(4,6,16,0.98);
        flex-direction: column;
    }

    .app-body {
        animation: appFadeIn 0.24s ease;
    }

    .app-body.animate-in {
        animation: appFadeIn 0.24s ease;
    }

    @keyframes appFadeIn {
        from { opacity: 0; transform: translateY(8px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .app-header {
        padding: 8px 10px;
        display: flex;
        align-items: center;
        gap: 8px;
        border-bottom: 1px solid rgba(255,255,255,0.06);
        background: linear-gradient(to bottom, rgba(0,0,0,0.7), rgba(0,0,0,0.3));
    }

    .app-back {
        width: 26px;
        height: 26px;
        border-radius: 999px;
        border: 1px solid rgba(255,255,255,0.3);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 14px;
        user-select: none;
        transition: background 0.15s ease, transform 0.12s ease;
    }

    .app-back:active {
        background: rgba(255,255,255,0.1);
        transform: scale(0.95);
    }

    .app-title {
        font-size: 14px;
        font-weight: 500;
    }

    .app-body {
        flex: 1;
        padding: 10px;
        font-size: 12px;
        overflow-y: auto;
        animation: fadeInUp var(--anim-speed) ease;
    }

    .app-section-title {
        font-size: 12px;
        font-weight: 600;
        margin: 6px 0 4px;
        opacity: 0.9;
    }

    .settings-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 6px 0;
        border-bottom: 1px solid rgba(255,255,255,0.06);
    }

    .settings-label {
        font-size: 12px;
    }

    .toggle {
        width: 34px;
        height: 18px;
        border-radius: 999px;
        background: rgba(255,255,255,0.2);
        padding: 2px;
        cursor: pointer;
        position: relative;
        transition: background 0.18s ease;
    }

    .toggle-knob {
        width: 14px;
        height: 14px;
        border-radius: 50%;
        background: #fff;
        position: absolute;
        left: 2px;
        top: 2px;
        transition: left 0.18s ease;
    }

    .toggle.on {
        background: #4caf50;
    }

    .toggle.on .toggle-knob {
        left: 18px;
    }

    .volume-overlay {
        position: absolute;
        right: 16px;
        top: 80px;
        width: 26px;
        padding: 8px 4px;
        background: rgba(0,0,0,0.7);
        border-radius: 16px;
        display: none;
        flex-direction: column;
        align-items: center;
        gap: 4px;
        z-index: 30;
        animation: fadeIn 0.18s ease;
    }

    .volume-bar {
        width: 6px;
        height: 80px;
        border-radius: 999px;
        background: rgba(255,255,255,0.15);
        overflow: hidden;
        position: relative;
    }

    .volume-fill {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: #4caf50;
        transition: height 0.18s ease;
    }

    .volume-icon {
        font-size: 14px;
    }

    .power-menu {
        position: absolute;
        inset: 0;
        background: rgba(0,0,0,0.7);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 40;
        animation: fadeIn 0.2s ease;
    }

    .power-menu-card {
        background: rgba(10,10,20,0.96);
        border-radius: 20px;
        padding: 16px 18px;
        width: 70%;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0,0,0,0.8);
        transform: translateY(10px);
        animation: slideUp 0.2s ease forwards;
    }

    .power-menu-title {
        font-size: 14px;
        margin-bottom: 10px;
    }

    .power-menu-buttons {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .btn {
        padding: 6px 10px;
        border-radius: 999px;
        border: none;
        cursor: pointer;
        font-size: 12px;
        font-weight: 500;
        box-shadow: 0 6px 14px rgba(0,0,0,0.28);
        transition: background 0.15s ease, transform 0.12s ease, box-shadow 0.15s ease;
    }

    .btn-primary {
        background: #f44336;
        color: #fff;
    }

    .btn-secondary {
        background: rgba(255,255,255,0.1);
        color: #fff;
    }

    .btn:active {
        transform: scale(0.96);
        box-shadow: 0 4px 10px rgba(0,0,0,0.6);
    }

    .boot-screen, .shutdown-screen {
        background: #000;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: #fff;
        font-size: 14px;
    }

    .boot-logo {
        font-size: 26px;
        font-weight: 600;
        margin-bottom: 10px;
        animation: fadeInDown 0.4s ease;
    }

    .boot-sub {
        font-size: 11px;
        opacity: 0.7;
    }

    .boot-loader {
        margin-top: 18px;
        width: 120px;
        height: 4px;
        border-radius: 999px;
        background: rgba(255,255,255,0.15);
        overflow: hidden;
        position: relative;
    }

    .boot-loader-fill {
        position: absolute;
        left: -40%;
        top: 0;
        bottom: 0;
        width: 40%;
        background: #4caf50;
        animation: bootload 1.2s linear infinite;
    }

    @keyframes bootload {
        0% { left: -40%; }
        100% { left: 100%; }
    }

    .sleep-overlay {
        background: #000;
    }

    .toast {
        position: absolute;
        bottom: 70px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0,0,0,0.85);
        padding: 6px 10px;
        border-radius: 999px;
        font-size: 11px;
        display: none;
        z-index: 50;
        animation: fadeInUp 0.2s ease;
    }

    .badge {
        display: inline-block;
        padding: 2px 6px;
        border-radius: 999px;
        background: rgba(255,255,255,0.1);
        font-size: 10px;
        margin-left: 4px;
    }

    .list-item {
        padding: 6px 0;
        border-bottom: 1px solid rgba(255,255,255,0.08);
        font-size: 12px;
    }

    .list-item-title {
        font-weight: 500;
    }

    .list-item-sub {
        font-size: 11px;
        opacity: 0.8;
    }

    .pill {
        display: inline-block;
        padding: 2px 6px;
        border-radius: 999px;
        border: 1px solid rgba(255,255,255,0.2);
        font-size: 10px;
        margin-top: 2px;
    }

    .app-store-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 8px;
    }

    .store-card {
        padding: 10px;
        border-radius: 14px;
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: background 0.18s ease, transform 0.18s ease, border-color 0.18s ease;
    }

    .store-card:hover {
        background: rgba(26,115,232,0.12);
        border-color: rgba(26,115,232,0.4);
        transform: translateY(-1px);
    }


    .store-card-icon {
        width: 34px;
        height: 34px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 10px;
        font-size: 17px;
        font-weight: 700;
        background: rgba(255,255,255,0.12);
    }

    .store-card-main {
        font-size: 12px;
    }

    .store-card-title {
        font-weight: 500;
    }

    .store-card-sub {
        font-size: 11px;
        opacity: 0.8;
    }

    .store-btn {
        padding: 6px 14px;
        border-radius: 999px;
        border: none;
        font-size: 11px;
        font-weight: 700;
        cursor: pointer;
        background: var(--android-blue);
        color: #fff;
        box-shadow: 0 6px 14px rgba(0,0,0,0.28);
        transition: background 0.15s ease, transform 0.12s ease;
    }

    .store-btn.installed {
        background: rgba(255,255,255,0.15);
        color: #d7e3ff;
    }

    .store-btn:active {
        transform: scale(0.95);
    }

    .camera-preview {
        width: 100%;
        height: 220px;
        border-radius: 16px;
        background: radial-gradient(circle at center, #555, #111);
        margin-bottom: 10px;
        position: relative;
        overflow: hidden;
        animation: subtlePan 6s linear infinite alternate;
    }

    .camera-overlay-text {
        position: absolute;
        bottom: 6px;
        left: 8px;
        font-size: 11px;
        opacity: 0.8;
    }

    .camera-controls {
        display: flex;
        justify-content: center;
        gap: 16px;
        margin-top: 6px;
    }

    .camera-shutter {
        width: 46px;
        height: 46px;
        border-radius: 50%;
        border: 3px solid #fff;
        background: rgba(255,255,255,0.1);
        cursor: pointer;
        transition: transform 0.12s ease, box-shadow 0.15s ease;
    }

    .camera-shutter:active {
        transform: scale(0.92);
        box-shadow: 0 0 0 4px rgba(255,255,255,0.2);
    }

    .camera-mode {
        font-size: 11px;
        opacity: 0.8;
        align-self: center;
    }

    .gallery-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 4px;
        margin-top: 6px;
    }

    .gallery-item {
        background: linear-gradient(135deg, #ff9800, #f44336);
        border-radius: 6px;
        height: 60px;
        font-size: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        animation: fadeIn 0.25s ease;
    }

    .call-screen {
        text-align: center;
        margin-top: 20px;
    }

    .call-name {
        font-size: 18px;
        margin-bottom: 4px;
    }

    .call-status {
        font-size: 12px;
        opacity: 0.8;
    }

    .call-controls {
        margin-top: 18px;
        display: flex;
        justify-content: center;
        gap: 18px;
    }

    .call-btn {
        width: 46px;
        height: 46px;
        border-radius: 50%;
        border: none;
        cursor: pointer;
        color: #fff;
        font-size: 18px;
        transition: transform 0.12s ease, box-shadow 0.15s ease;
    }

    .call-btn.accept {
        background: #4caf50;
    }

    .call-btn.decline {
        background: #f44336;
    }

    .call-btn.fake {
        background: #607d8b;
        font-size: 14px;
    }

    .call-btn:active {
        transform: scale(0.94);
        box-shadow: 0 4px 10px rgba(0,0,0,0.6);
    }

    .map-box {
        height: 200px;
        border-radius: 14px;
        background: radial-gradient(circle at 20% 20%, #4caf50, #1b5e20 40%, #0d47a1 70%, #000);
        position: relative;
        overflow: hidden;
        margin-bottom: 10px;
        animation: subtlePan 10s linear infinite alternate;
    }

    .map-marker {
        position: absolute;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: #ffeb3b;
        box-shadow: 0 0 8px #ffeb3b;
        transition: transform 0.3s ease;
    }

    .map-label {
        position: absolute;
        bottom: 6px;
        left: 8px;
        font-size: 11px;
        background: rgba(0,0,0,0.5);
        padding: 2px 6px;
        border-radius: 999px;
    }

    .storage-bar {
        width: 100%;
        height: 8px;
        border-radius: 999px;
        background: rgba(255,255,255,0.1);
        overflow: hidden;
        margin-top: 4px;
    }

    .storage-fill {
        height: 100%;
        background: linear-gradient(to right, #4caf50, #ff9800, #f44336);
        width: 30%;
        transition: width var(--anim-speed) ease;
    }

    .error-banner {
        padding: 6px 8px;
        border-radius: 10px;
        background: rgba(244,67,54,0.15);
        border: 1px solid rgba(244,67,54,0.6);
        font-size: 11px;
        margin-bottom: 8px;
    }

    .sleep-hint {
        font-size: 11px;
        opacity: 0.7;
        margin-top: 10px;
    }

    .mini-chip {
        display: inline-block;
        padding: 2px 6px;
        border-radius: 999px;
        background: rgba(255,255,255,0.08);
        font-size: 10px;
        margin-right: 4px;
        margin-top: 2px;
    }

    .nav-bar {
        position: absolute;
        left: 0;
        right: 0;
        bottom: 0;
        height: 56px;
        background: #000;
        display: flex;
        align-items: center;
        justify-content: space-around;
        z-index: 18;
    }

    .nav-btn {
        width: 42px;
        height: 42px;
        border-radius: 999px;
        border: none;
        background: transparent;
        color: #fff;
        font-size: 22px;
        cursor: pointer;
    }

    .nav-btn:active {
        transform: scale(0.9);
        background: rgba(255,255,255,0.12);
    }

    .shutdown-screen-text {
        text-align: center;
        font-size: 13px;
        opacity: 0.9;
    }

    .shutdown-hint {
        margin-top: 10px;
        font-size: 11px;
        opacity: 0.7;
    }

    .browser-input-row {
        display: flex;
        gap: 4px;
        margin-bottom: 6px;
    }

    .browser-input-row input {
        flex: 1;
        padding: 4px 6px;
        border-radius: 999px;
        border: none;
        font-size: 11px;
        outline: none;
    }

    .browser-input-row button {
        padding: 4px 8px;
        border-radius: 999px;
        border: none;
        font-size: 11px;
        cursor: pointer;
        background: #4caf50;
        color: #fff;
        transition: transform 0.12s ease, background 0.15s ease;
    }

    .browser-input-row button:active {
        transform: scale(0.95);
    }

    .messages-input-row {
        display: flex;
        gap: 4px;
        margin-top: 6px;
    }

    .messages-input-row input {
        flex: 1;
        padding: 4px 6px;
        border-radius: 999px;
        border: none;
        font-size: 11px;
        outline: none;
    }

    .messages-input-row button {
        padding: 4px 8px;
        border-radius: 999px;
        border: none;
        font-size: 11px;
        cursor: pointer;
        background: #4caf50;
        color: #fff;
        transition: transform 0.12s ease, background 0.15s ease;
    }

    .messages-input-row button:active {
        transform: scale(0.95);
    }

    /* Dev overlays */

    .dev-overlay {
        position: absolute;
        top: 34px;
        left: 6px;
        right: 6px;
        display: none;
        z-index: 25;
        pointer-events: none;
        font-size: 10px;
        color: #0f0;
        text-shadow: 0 0 4px #000;
    }

    .dev-overlay.visible {
        display: block;
    }

    .dev-overlay-row {
        display: flex;
        justify-content: space-between;
        gap: 4px;
    }

    .dev-overlay-box {
        background: rgba(0,0,0,0.7);
        border-radius: 8px;
        padding: 4px 6px;
        margin-bottom: 4px;
        border: 1px solid rgba(0,255,0,0.4);
    }

    .dev-touch-indicator {
        position: absolute;
        width: 26px;
        height: 26px;
        border-radius: 50%;
        border: 2px solid rgba(0,255,0,0.8);
        pointer-events: none;
        transform: translate(-50%, -50%);
        animation: devTouch 0.4s ease-out forwards;
        z-index: 60;
    }

    @keyframes devTouch {
        from { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        to { opacity: 0; transform: translate(-50%, -50%) scale(1.6); }
    }

    .dev-bounds .widget,
    .dev-bounds .app-grid,
    .dev-bounds .dock,
    .dev-bounds .lock-screen,
    .dev-bounds .app-screen,
    .dev-bounds .status-bar {
        outline: 1px dashed rgba(0,255,0,0.6);
    }

    .dev-log-list {
        max-height: 260px;
        overflow-y: auto;
        font-size: 11px;
    }

    .dev-log-item {
        padding: 4px 0;
        border-bottom: 1px solid rgba(255,255,255,0.08);
    }

    .dev-log-time {
        opacity: 0.7;
        margin-right: 4px;
    }

    .dev-log-text {
        opacity: 0.95;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(6px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes fadeInDown {
        from {
            opacity: 0;
            transform: translateY(-6px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    @keyframes slideUp {
        from { transform: translateY(16px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }

    @keyframes subtlePan {
        from { transform: translate3d(-4px, -4px, 0) scale(1.02); }
        to { transform: translate3d(4px, 4px, 0) scale(1.02); }
    }
</style>
</head>
<body>
<div class="phone-frame">
    <div class="side-button power" id="btnPower"></div>
    <div class="side-button vol-up" id="btnVolUp"></div>
    <div class="side-button vol-down" id="btnVolDown"></div>

    <div class="phone-screen awake" id="phoneScreen">
        <!-- Dev overlay -->
        <div class="dev-overlay" id="devOverlay">
            <div class="dev-overlay-row">
                <div class="dev-overlay-box" id="devFpsBox">FPS: -- ‚Ä¢ CPU: --%</div>
                <div class="dev-overlay-box" id="devNetBox">Net: -- ‚Ä¢ Ping: --ms</div>
            </div>
        </div>

        <div class="dropdown-shade" id="dropdownShade">
            <div class="shade-header">
                <div>
                    <div class="shade-title">GSO Quick Panel</div>
                    <div style="font-size:11px;opacity:0.8;" id="shadeSubtitle">Balanced ‚Ä¢ Network: detecting‚Ä¶</div>
                </div>
                <button class="btn btn-secondary" style="padding:4px 8px;font-size:10px;" id="btnShadeClose">Close</button>
            </div>
            <div class="shade-grid">
                <div class="shade-tile active" data-toggle="wifi">
                    <div>üì∂</div>
                    <div class="shade-tile-label">Wi‚ÄëFi</div>
                </div>
                <div class="shade-tile active" data-toggle="bt">
                    <div>üåÄ</div>
                    <div class="shade-tile-label">Bluetooth</div>
                </div>
                <div class="shade-tile active" data-toggle="cell">
                    <div>üì°</div>
                    <div class="shade-tile-label">Cellular</div>
                </div>
                <div class="shade-tile" data-toggle="airplane">
                    <div>‚úàÔ∏è</div>
                    <div class="shade-tile-label">Airplane</div>
                </div>
                <div class="shade-tile active" data-toggle="dnd">
                    <div>üåô</div>
                    <div class="shade-tile-label">Do Not Disturb</div>
                </div>
                <div class="shade-tile" data-toggle="hotspot">
                    <div>üì≤</div>
                    <div class="shade-tile-label">Hotspot</div>
                </div>
                <div class="shade-tile" data-toggle="batterySaver">
                    <div>ü™´</div>
                    <div class="shade-tile-label">Battery Saver</div>
                </div>
                <div class="shade-tile" data-toggle="devMode">
                    <div>üë®‚Äçüíª</div>
                    <div class="shade-tile-label">Dev Mode</div>
                </div>
            </div>
            <div class="shade-slider-row">
                <div class="shade-slider-label">Brightness</div>
                <input type="range" min="10" max="100" value="70" class="shade-slider" id="brightnessSlider">
            </div>
            <div class="shade-slider-row">
                <div class="shade-slider-label">Media volume</div>
                <input type="range" min="0" max="100" value="60" class="shade-slider" id="volumeSlider">
            </div>
        </div>

        <div class="status-bar" id="statusBar">
            <div class="status-left">
                <span id="statusTime">18:41</span>
            </div>
            <div class="status-center">
                GSO PHONE
            </div>
            <div class="status-right">
                <div class="icon-signal"><div class="signal-bar"></div></div>
                <div class="icon-wifi"><div class="wifi-dot"></div></div>
                <div class="icon-battery">
                    <div class="battery-level" id="batteryLevel"></div>
                </div>
                <span id="batteryPercent" style="font-size:10px;">100%</span>
            </div>
        </div>

        <div class="content">
            <div class="boot-screen active" id="bootScreen">
                <div class="boot-logo">GSO</div>
                <div class="boot-sub">GSO Phone OS ‚Ä¢ Ultra Simulated</div>
                <div class="boot-loader"><div class="boot-loader-fill"></div></div>
                <div class="sleep-hint">Booting‚Ä¶ using your real time & network</div>
            </div>

            <div class="shutdown-screen" id="shutdownScreen">
                <div class="boot-logo">GSO</div>
                <div class="shutdown-screen-text" id="shutdownText">
                    Shutting down GSO Phone‚Ä¶<br>
                    All systems are now offline.
                </div>
                <div class="shutdown-hint" id="shutdownHint">
                    Press the power button to boot again.
                </div>
            </div>

            <div class="sleep-overlay" id="sleepOverlay"></div>

            <div class="lock-screen" id="lockScreen">
                <div>
                    <div class="lock-time" id="lockTime">18:41</div>
                    <div class="lock-date" id="lockDate">Friday, February 20</div>
                </div>
                <div class="lock-notifications" id="lockNotifications"></div>
                <div>
                    <div class="lock-pin">
                        <div class="lock-auth-panel" id="lockAuthPanel">
                            <button class="lock-unlock-btn" id="btnUnlockPrompt">Unlock</button>
                            <button class="lock-action-btn" id="btnFingerprintUnlock">üÜî Fingerprint unlock</button>
                            <div class="lock-swipe-hint">Swipe up to open passcode</div>
                        </div>
                        <div class="pin-entry-panel hidden" id="pinEntryPanel">
                            <div class="pin-dots" id="pinDots">
                                <div class="pin-dot"></div>
                                <div class="pin-dot"></div>
                                <div class="pin-dot"></div>
                                <div class="pin-dot"></div>
                            </div>
                            <div class="pin-pad" id="pinPad">
                                <button class="pin-key" data-key="1"><span>1</span></button>
                                <button class="pin-key" data-key="2"><span>2</span></button>
                                <button class="pin-key" data-key="3"><span>3</span></button>
                                <button class="pin-key" data-key="4"><span>4</span></button>
                                <button class="pin-key" data-key="5"><span>5</span></button>
                                <button class="pin-key" data-key="6"><span>6</span></button>
                                <button class="pin-key" data-key="7"><span>7</span></button>
                                <button class="pin-key" data-key="8"><span>8</span></button>
                                <button class="pin-key" data-key="9"><span>9</span></button>
                                <button class="pin-key" data-key="clear"><span>‚å´</span></button>
                                <button class="pin-key" data-key="0"><span>0</span></button>
                                <button class="pin-key" data-key="ok"><span>‚èé</span></button>
                            </div>
                        </div>
                    </div>
                    <div class="lock-footer">
                        Real time. Real network status. Fake phone.<br>
                        GSO Phone runs entirely in your browser.
                    </div>
                </div>
            </div>

            <div class="home-screen" id="homeScreen">
                <div>
                    <div class="widget-row">
                        <div class="widget">
                            <div class="widget-title">Weather ‚Ä¢ Your location</div>
                            <div class="widget-main" id="widgetWeatherMain">--¬∞C</div>
                            <div class="widget-sub" id="widgetWeatherSub">Fetching real temperature‚Ä¶</div>
                        </div>
                        <div class="widget">
                            <div class="widget-title">System status</div>
                            <div class="widget-main" id="widgetStatusMain">All systems ready</div>
                            <div class="widget-sub" id="widgetStatusSub">Battery: 100% ‚Ä¢ Network: detecting‚Ä¶</div>
                        </div>
                    </div>
                    <div class="widget-row">
                        <div class="widget">
                            <div class="widget-title">Today</div>
                            <div class="widget-main" id="widgetTodayMain">Loading real date‚Ä¶</div>
                            <div class="widget-sub">Events list is simulated, but time is real.</div>
                        </div>
                    </div>
                    <div class="app-grid" id="appGrid"></div>
                    <div class="app-pager" id="appPager"></div>
                </div>
                <div>
                    <div class="dock" id="dock"></div>
                </div>
            </div>

            <div class="app-screen" id="appScreen">
                <div class="app-header">
                    <div class="app-back" id="btnAppBack">‚Äπ</div>
                    <div class="app-title" id="appTitle">App</div>
                </div>
                <div class="app-body" id="appBody"></div>
            </div>

            <div class="nav-bar" id="navBar">
                <button class="nav-btn" id="btnNavBack" aria-label="Back">‚óÄ</button>
                <button class="nav-btn" id="btnNavHome" aria-label="Home">‚óâ</button>
                <button class="nav-btn" id="btnRecents" aria-label="Recents">‚óª</button>
            </div>
        </div>

        <div class="volume-overlay" id="volumeOverlay">
            <div class="volume-icon" id="volumeIcon">üîä</div>
            <div class="volume-bar">
                <div class="volume-fill" id="volumeFill" style="height:60%;"></div>
            </div>
        </div>

        <div class="power-menu" id="powerMenu">
            <div class="power-menu-card">
                <div class="power-menu-title">GSO Power Menu</div>
                <div class="power-menu-buttons">
                    <button class="btn btn-primary" id="btnShutdown">Power off</button>
                    <button class="btn btn-secondary" id="btnRestart">Restart</button>
                    <button class="btn btn-secondary" id="btnEmergency">Emergency mode</button>
                    <button class="btn btn-secondary" id="btnCancelPower">Cancel</button>
                </div>
            </div>
        </div>

        <div class="toast" id="toast"></div>
    </div>
</div>

<script>
(function() {
    const LS_KEY = 'gsoPhoneStateDevV1';

    const phoneScreen = document.getElementById('phoneScreen');
    const bootScreen = document.getElementById('bootScreen');
    const shutdownScreen = document.getElementById('shutdownScreen');
    const sleepOverlay = document.getElementById('sleepOverlay');
    const lockScreen = document.getElementById('lockScreen');
    const homeScreen = document.getElementById('homeScreen');
    const appScreen = document.getElementById('appScreen');
    const appTitle = document.getElementById('appTitle');
    const appBody = document.getElementById('appBody');
    const statusTime = document.getElementById('statusTime');
    const lockTime = document.getElementById('lockTime');
    const lockDate = document.getElementById('lockDate');
    const batteryLevel = document.getElementById('batteryLevel');
    const batteryPercent = document.getElementById('batteryPercent');
    const widgetStatusSub = document.getElementById('widgetStatusSub');
    const widgetWeatherMain = document.getElementById('widgetWeatherMain');
    const widgetWeatherSub = document.getElementById('widgetWeatherSub');
    const widgetTodayMain = document.getElementById('widgetTodayMain');
    const dropdownShade = document.getElementById('dropdownShade');
    const btnShadeClose = document.getElementById('btnShadeClose');
    const brightnessSlider = document.getElementById('brightnessSlider');
    const volumeSlider = document.getElementById('volumeSlider');
    const volumeOverlay = document.getElementById('volumeOverlay');
    const volumeFill = document.getElementById('volumeFill');
    const volumeIcon = document.getElementById('volumeIcon');
    const toast = document.getElementById('toast');
    const powerMenu = document.getElementById('powerMenu');
    const btnPower = document.getElementById('btnPower');
    const btnVolUp = document.getElementById('btnVolUp');
    const btnVolDown = document.getElementById('btnVolDown');
    const btnAppBack = document.getElementById('btnAppBack');
    const btnRecents = document.getElementById('btnRecents');
    const btnNavBack = document.getElementById('btnNavBack');
    const btnNavHome = document.getElementById('btnNavHome');
    const lockNotifications = document.getElementById('lockNotifications');
    const statusBar = document.getElementById('statusBar');
    const shadeSubtitle = document.getElementById('shadeSubtitle');

    const btnShutdown = document.getElementById('btnShutdown');
    const btnRestart = document.getElementById('btnRestart');
    const btnEmergency = document.getElementById('btnEmergency');
    const btnCancelPower = document.getElementById('btnCancelPower');

    const pinDots = document.getElementById('pinDots').children;
    const pinPad = document.getElementById('pinPad');
    const pinEntryPanel = document.getElementById('pinEntryPanel');
    const lockAuthPanel = document.getElementById('lockAuthPanel');
    const btnUnlockPrompt = document.getElementById('btnUnlockPrompt');
    const btnFingerprintUnlock = document.getElementById('btnFingerprintUnlock');
    const shutdownText = document.getElementById('shutdownText');
    const shutdownHint = document.getElementById('shutdownHint');

    const appGrid = document.getElementById('appGrid');
    const appPager = document.getElementById('appPager');
    const dock = document.getElementById('dock');

    const devOverlay = document.getElementById('devOverlay');
    const devFpsBox = document.getElementById('devFpsBox');
    const devNetBox = document.getElementById('devNetBox');

    let intervals = [];
    let fpsLastTime = performance.now();
    let fpsFrames = 0;
    let fpsValue = 0;
    let cpuValue = 0;
    const APPS_PER_PAGE = 8;
    let homeSwipeStartX = null;
    let lockSwipeStartY = null;

    let state = {
        poweredOn: true,
        sleeping: false,
        locked: true,
        currentApp: null,
        volume: 60,
        battery: 100,
        fakeWeather: 21,
        fakeWeatherDesc: 'Fetching real weather‚Ä¶',
        fakeEvents: 0,
        wifiOn: true,
        btOn: true,
        cellOn: true,
        airplane: false,
        dnd: true,
        hotspot: false,
        batterySaver: false,
        devMode: false,
        brightness: 70,
        pin: '1234',
        pinInput: '',
        fingerprintEnabled: true,
        darkMode: false,
        batteryDead: false,
        powerMenuVisible: false,
        recents: [],
        fakeLocationIndex: 0,
        fakeLocations: [
            'GSO‚ÄëCity Center',
            'GSO‚ÄëRiverfront',
            'GSO‚ÄëTech Park',
            'GSO‚ÄëOld Town',
            'GSO‚ÄëHarbor'
        ],
        fakeCallActive: false,
        fakeCallTimer: 0,
        emergencyMode: false,
        storageUsed: 30,
        galleryPhotos: 0,
        notesText: '',
        storeInstalled: {},
        messages: [],
        homePage: 0,
        appOrder: null,
        logs: [],
        devShowFps: true,
        devShowTouches: true,
        devShowBounds: false,
        devShowCpu: true,
        devShowNetDebug: true,
        devSlowAnimations: false,
        devDebugFlashes: true,
        gameTapBest: 0,
        gameGuessBest: null,
        gsoCoins: 500,
        ransomwareActive: false,
        oneUiMode: false,
        galaxyTheme: "oneui-light",
        wallpaper: 'ocean',
        colorTheme: null,
        voiceMemos: [],
        fakeAlarms: [],
        fakeEventsList: [],
        fakeSocialFeed: []
    };

    const apps = [
        { id: 'phone', name: 'Phone', icon: 'üìû', type: 'system', dock: true },
        { id: 'messages', name: 'Messages', icon: 'üí¨', type: 'system', dock: true },
        { id: 'contacts', name: 'Contacts', icon: 'üë§', type: 'system', dock: false },
        { id: 'camera', name: 'Camera', icon: 'üì∑', type: 'media', dock: false },
        { id: 'gallery', name: 'Gallery', icon: 'üñºÔ∏è', type: 'media', dock: false },
        { id: 'browser', name: 'Browser', icon: 'üåê', type: 'tools', dock: true },
        { id: 'music', name: 'Music', icon: 'üéµ', type: 'media', dock: false },
        { id: 'maps', name: 'Maps', icon: 'üó∫Ô∏è', type: 'tools', dock: false },
        { id: 'files', name: 'Files', icon: 'üìÅ', type: 'tools', dock: false },
        { id: 'notes', name: 'Notes', icon: 'üìù', type: 'tools', dock: false },
        { id: 'calendar', name: 'Calendar', icon: 'üìÖ', type: 'tools', dock: false },
        { id: 'clock', name: 'Clock', icon: 'üïí', type: 'tools', dock: false },
        { id: 'calculator', name: 'Calculator', icon: 'üßÆ', type: 'tools', dock: false },
        { id: 'recorder', name: 'Recorder', icon: 'üéôÔ∏è', type: 'tools', dock: false },
        { id: 'alarm', name: 'Alarm', icon: '‚è∞', type: 'tools', dock: false },
        { id: 'settings', name: 'Settings', icon: '‚öôÔ∏è', type: 'system', dock: false },
        { id: 'store', name: 'GS Play Store', icon: 'üõçÔ∏è', type: 'store', dock: false },
        { id: 'virusPrank', name: 'Virus Prank', icon: 'ü¶†', type: 'tools', dock: false },
        { id: 'gsDefence', name: 'GS Defence', icon: 'üõ°Ô∏è', type: 'tools', dock: false },
        { id: 'wannaCrySim', name: 'WannaCry Sim', icon: 'üîí', type: 'tools', dock: false },

        // Dev-only apps (visible when devMode is true)
        { id: 'sysLogs', name: 'System Logs', icon: 'üìã', type: 'tools', dock: false, devOnly: true },
        { id: 'uiTuner', name: 'UI Tuner', icon: 'üéõÔ∏è', type: 'tools', dock: false, devOnly: true },
        { id: 'experiments', name: 'Experiments', icon: 'üß™', type: 'tools', dock: false, devOnly: true }
    ];

    const storeApps = [
        { id: 'gamesHub', name: 'GSO Games Hub', icon:'üéÆ', desc: 'Arcade, puzzles, and fake leaderboards.' },
        { id: 'socialPlus', name: 'Social+', icon:'üó®Ô∏è', desc: 'All your imaginary friends in one place.' },
        { id: 'cryptoWatch', name: 'CryptoWatch', icon:'‚Çø', desc: 'Track fake coins to the fake moon.' },
        { id: 'weatherPro', name: 'Weather Pro+', icon:'‚õÖ', desc: 'Hyper-detailed simulated forecasts.' },
        { id: 'gsoMail', name: 'Gmail', icon:'üìß', desc: 'Email management with a Gmail-like simulated UI.' },
        { id: 'googleDrive', name: 'Google Drive', icon:'üíæ', desc: 'Cloud storage and file sync simulation.' },
        { id: 'samsungHealth', name: 'Samsung Health', icon:'‚ù§', desc: 'Health and activity tracking simulation.' },
        { id: 'samsungInternet', name: 'Samsung Internet', icon:'üåê', desc: 'Samsung web browser style simulation.' },
        { id: 'samsungNotes', name: 'Samsung Notes', icon:'üìù', desc: 'Create and organize notes Samsung-style.' },
        { id: 'galaxyThemes', name: 'Galaxy Themes', icon:'üé≠', desc: 'Personalize One UI colors and icons (simulated).' },
        { id: 'oneUiHome', name: 'One UI Home', icon:'üè†', desc: 'Samsung-style launcher customization demo.' },
        { id: 'miuiGallery', name: 'MIUI Gallery', icon:'üñºÔ∏è', desc: 'Xiaomi-inspired gallery management simulation.' },
        { id: 'replicaLab', name: 'Replica Lab', icon:'üß¨', desc: 'Build harmless fake-clone profiles for UI demos.' }
    ];

    function logEvent(text) {
        const now = new Date();
        const time = now.toLocaleTimeString(undefined, { hour12: false });
        state.logs.unshift({ time, text });
        if (state.logs.length > 200) state.logs.pop();
    }

    function clearRansomware(reason) {
        state.ransomwareActive = false;
        saveState();
        showToast('Ransomware removed (simulated)');
        logEvent('Ransomware removed via ' + reason);
    }

    function saveState() {
        const toSave = {
            battery: state.battery,
            fakeWeather: state.fakeWeather,
            fakeWeatherDesc: state.fakeWeatherDesc,
            fakeEvents: state.fakeEvents,
            wifiOn: state.wifiOn,
            btOn: state.btOn,
            cellOn: state.cellOn,
            airplane: state.airplane,
            dnd: state.dnd,
            hotspot: state.hotspot,
            batterySaver: state.batterySaver,
            devMode: state.devMode,
            brightness: state.brightness,
            pin: state.pin,
            fingerprintEnabled: state.fingerprintEnabled,
            darkMode: state.darkMode,
            batteryDead: state.batteryDead,
            storageUsed: state.storageUsed,
            galleryPhotos: state.galleryPhotos,
            notesText: state.notesText,
            storeInstalled: state.storeInstalled,
            messages: state.messages,
            homePage: state.homePage,
            appOrder: state.appOrder,
            logs: state.logs,
            devShowFps: state.devShowFps,
            devShowTouches: state.devShowTouches,
            devShowBounds: state.devShowBounds,
            devShowCpu: state.devShowCpu,
            devShowNetDebug: state.devShowNetDebug,
            devSlowAnimations: state.devSlowAnimations,
            devDebugFlashes: state.devDebugFlashes,
            gameTapBest: state.gameTapBest,
            gameGuessBest: state.gameGuessBest,
            gsoCoins: state.gsoCoins,
            ransomwareActive: state.ransomwareActive,
            oneUiMode: state.oneUiMode,
            galaxyTheme: state.galaxyTheme,
            wallpaper: state.wallpaper,
            colorTheme: state.colorTheme,
            voiceMemos: state.voiceMemos,
            fakeAlarms: state.fakeAlarms,
            fakeEventsList: state.fakeEventsList,
            fakeSocialFeed: state.fakeSocialFeed
        };
        try {
            localStorage.setItem(LS_KEY, JSON.stringify(toSave));
        } catch (e) {}
    }

    function loadState() {
        try {
            const raw = localStorage.getItem(LS_KEY);
            if (!raw) return;
            const saved = JSON.parse(raw);
            Object.assign(state, saved);
        } catch (e) {}
    }

    function showToast(text, duration = 1500) {
        toast.textContent = text;
        toast.style.display = 'block';
        toast.style.opacity = '1';
        setTimeout(() => {
            toast.style.opacity = '0';
            setTimeout(() => {
                toast.style.display = 'none';
            }, 200);
        }, duration);
    }

    function updateTime() {
        const now = new Date();
        const h = now.getHours().toString().padStart(2, '0');
        const m = now.getMinutes().toString().padStart(2, '0');
        statusTime.textContent = `${h}:${m}`;
        lockTime.textContent = `${h}:${m}`;

        const options = { weekday: 'long', month: 'long', day: 'numeric' };
        lockDate.textContent = now.toLocaleDateString(undefined, options);
        widgetTodayMain.textContent = now.toLocaleDateString(undefined, { weekday: 'long', month: 'long', day: 'numeric' });
    }

    function updateBatteryUI() {
        batteryLevel.style.width = state.battery + '%';
        batteryPercent.textContent = state.battery + '%';
        widgetStatusSub.textContent = `Battery: ${state.battery}% ‚Ä¢ Network: ${navigator.onLine ? 'Online' : 'Offline'}`;
    }

    function drainBattery() {
        if (!state.poweredOn) return;
        if (state.batterySaver && state.battery > 1) {
            if (Math.random() < 0.5) return;
        }
        if (state.battery > 0) {
            state.battery -= 1;
            if (state.battery < 0) state.battery = 0;
            updateBatteryUI();
            saveState();
            logEvent('Battery tick: ' + state.battery + '%');
            if (state.battery === 15) {
                showToast('Battery low: 15% remaining');
                pushNotification('Battery', 'Battery low. Consider enabling Battery Saver.');
            }
            if (state.battery === 0) {
                state.batteryDead = true;
                showToast('Battery empty. Phone turned off.');
                logEvent('Battery depleted to 0%');
                setTimeout(() => {
                    performShutdown();
                }, 600);
            }
        }
    }

    function updateWeatherFromAPI(lat, lon) {
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${encodeURIComponent(lat)}&longitude=${encodeURIComponent(lon)}&current_weather=true`;
        fetch(url)
            .then(r => r.json())
            .then(data => {
                if (data && data.current_weather) {
                    const temp = data.current_weather.temperature;
                    const code = data.current_weather.weathercode;
                    const descMap = {
                        0: 'Clear sky',
                        1: 'Mainly clear',
                        2: 'Partly cloudy',
                        3: 'Overcast',
                        45: 'Fog',
                        48: 'Depositing rime fog',
                        51: 'Light drizzle',
                        53: 'Drizzle',
                        55: 'Dense drizzle',
                        61: 'Slight rain',
                        63: 'Rain',
                        65: 'Heavy rain',
                        71: 'Slight snow',
                        73: 'Snow',
                        75: 'Heavy snow',
                        80: 'Rain showers',
                        81: 'Rain showers',
                        82: 'Heavy showers',
                        95: 'Thunderstorm'
                    };
                    const desc = descMap[code] || 'Weather data';
                    state.fakeWeather = temp;
                    state.fakeWeatherDesc = desc + ' (real)';
                    widgetWeatherMain.textContent = temp.toFixed(1) + '¬∞C';
                    widgetWeatherSub.textContent = state.fakeWeatherDesc;
                    saveState();
                    logEvent('Weather updated from API');
                } else {
                    widgetWeatherSub.textContent = 'Weather service error, using simulated data.';
                    logEvent('Weather API error, fallback to fake');
                }
            })
            .catch(() => {
                widgetWeatherSub.textContent = 'Weather service error, using simulated data.';
                logEvent('Weather API fetch failed');
            });
    }

    function initRealWeather() {
        if (!navigator.geolocation) {
            widgetWeatherSub.textContent = 'Geolocation not available, using simulated weather.';
            return;
        }
        navigator.geolocation.getCurrentPosition(
            pos => {
                const { latitude, longitude } = pos.coords;
                widgetWeatherSub.textContent = 'Using your real location.';
                logEvent('Geolocation success');
                updateWeatherFromAPI(latitude, longitude);
            },
            () => {
                widgetWeatherSub.textContent = 'Location denied, using simulated weather.';
                logEvent('Geolocation denied');
            },
            { enableHighAccuracy: false, timeout: 5000, maximumAge: 600000 }
        );
    }

    function pushNotification(title, body) {
        if (state.dnd) return;
        const card = document.createElement('div');
        card.className = 'notif-card';
        card.innerHTML = `
            <div class="notif-title">${title}</div>
            <div class="notif-body">${body}</div>
        `;
        lockNotifications.prepend(card);
        const cards = lockNotifications.querySelectorAll('.notif-card');
        if (cards.length > 6) {
            cards[cards.length - 1].remove();
        }
        logEvent('Notification: ' + title + ' ‚Äì ' + body);
    }

    function randomNotification() {
        if (!state.poweredOn) return;
        const pool = [
            ['GSO System', 'Background tasks completed successfully.'],
            ['GS Play Store', 'New apps are available for download.'],
            ['Weather Pro+', 'Check detailed forecast in the Weather Pro+ app.'],
            ['GSO Assistant', 'You have 0 unread real messages.'],
            ['Battery', 'Battery health is excellent.']
        ];
        const [t, b] = pool[Math.floor(Math.random() * pool.length)];
        pushNotification(t, b);
    }

    function setActiveScreen(screen) {
        [bootScreen, shutdownScreen, sleepOverlay, lockScreen, homeScreen, appScreen].forEach(el => {
            el.classList.remove('active');
            el.style.display = 'none';
        });
        screen.style.display = 'flex';
        requestAnimationFrame(() => {
            screen.classList.add('active');
        });
    }

    function goHome() {
        state.currentApp = null;
        setActiveScreen(homeScreen);
        logEvent('Navigate: Home');
    }

    function lockPhone() {
        state.locked = true;
        state.pinInput = '';
        updatePinDots();
        hidePasscodeEntry();
        setActiveScreen(lockScreen);
        logEvent('Phone locked');
    }

    function unlockPhone() {
        state.locked = false;
        goHome();
        logEvent('Phone unlocked');
    }

    function sleepPhone() {
        state.sleeping = true;
        phoneScreen.classList.add('sleeping');
        phoneScreen.classList.remove('awake');
        sleepOverlay.style.display = 'flex';
        requestAnimationFrame(() => {
            sleepOverlay.classList.add('active');
        });
        logEvent('Sleep: screen off');
    }

    function wakePhone() {
        state.sleeping = false;
        phoneScreen.classList.remove('sleeping');
        phoneScreen.classList.add('awake');
        sleepOverlay.classList.remove('active');
        setTimeout(() => {
            sleepOverlay.style.display = 'none';
        }, 200);
        if (state.locked) {
            setActiveScreen(lockScreen);
        } else if (state.currentApp) {
            setActiveScreen(appScreen);
        } else {
            setActiveScreen(homeScreen);
        }
        logEvent('Wake: screen on');
    }

    let chargerInterval = null;

    function clearAllIntervals() {
        intervals.forEach(id => clearInterval(id));
        intervals = [];
    }

    function updateShutdownStatus(text, hint) {
        if (shutdownText) shutdownText.innerHTML = text;
        if (shutdownHint) shutdownHint.textContent = hint;
    }

    function applyDarkMode() {
        document.body.classList.toggle('dark-mode', !!state.darkMode);
    }

    function startChargingFromDeadBattery() {
        if (!state.batteryDead) return;
        if (chargerInterval) return;
        updateShutdownStatus('Battery is fully drained (0%).<br>Charging connected.', 'Charging... tap power to boot once battery has charge.');
        showToast('Charger connected');
        logEvent('Charger connected');
        chargerInterval = setInterval(() => {
            state.battery = Math.min(100, state.battery + 2);
            updateBatteryUI();
            saveState();
            if (state.battery >= 5) {
                clearInterval(chargerInterval);
                chargerInterval = null;
                state.batteryDead = false;
                updateShutdownStatus('Battery recovered. Ready to boot.', 'Press power button to boot again.');
                showToast('Battery recovered: ' + state.battery + '%');
                saveState();
            }
        }, 1200);
    }

    function performShutdown() {
        state.poweredOn = false;
        state.sleeping = false;
        state.locked = true;
        state.currentApp = null;
        state.powerMenuVisible = false;
        powerMenu.style.display = 'none';
        clearAllIntervals();
        if (state.batteryDead) {
            updateShutdownStatus('Battery is fully drained (0%).<br>Phone is off.', 'Tap screen to plug in charger.');
        } else {
            updateShutdownStatus('Shutting down GSO Phone‚Ä¶<br>All systems are now offline.', 'Press the power button to boot again.');
        }
        setActiveScreen(shutdownScreen);
        saveState();
        logEvent('System: shutdown');
    }

    function performBoot() {
        if (state.battery <= 0 || state.batteryDead) {
            showToast('Battery empty. Tap screen to plug charger.');
            state.batteryDead = true;
            performShutdown();
            return;
        }
        if (chargerInterval) {
            clearInterval(chargerInterval);
            chargerInterval = null;
        }
        state.poweredOn = true;
        state.sleeping = false;
        state.locked = true;
        state.currentApp = null;
        setActiveScreen(bootScreen);
        logEvent('System: boot');
        setTimeout(() => {
            lockPhone();
            startIntervals();
        }, 2000);
    }

    function showPowerMenu() {
        if (!state.poweredOn) return;
        state.powerMenuVisible = true;
        powerMenu.style.display = 'flex';
        logEvent('Power menu opened');
    }

    function hidePowerMenu() {
        state.powerMenuVisible = false;
        powerMenu.style.display = 'none';
        logEvent('Power menu closed');
    }

    function showVolumeOverlay() {
        volumeOverlay.style.display = 'flex';
        volumeFill.style.height = state.volume + '%';
        if (state.volume === 0) {
            volumeIcon.textContent = 'üîá';
        } else if (state.volume < 40) {
            volumeIcon.textContent = 'üîâ';
        } else {
            volumeIcon.textContent = 'üîä';
        }
        setTimeout(() => {
            volumeOverlay.style.opacity = '0';
            setTimeout(() => {
                volumeOverlay.style.display = 'none';
                volumeOverlay.style.opacity = '1';
            }, 180);
        }, 800);
    }

    function changeVolume(delta) {
        state.volume = Math.max(0, Math.min(100, state.volume + delta));
        volumeSlider.value = state.volume;
        showVolumeOverlay();
        saveState();
        logEvent('Volume changed: ' + state.volume);
    }

    function updateBrightness() {
        const v = state.brightness / 100;
        phoneScreen.style.filter = `brightness(${0.4 + v * 0.6})`;
    }

    function showPasscodeEntry() {
        lockAuthPanel.classList.add('hidden');
        pinEntryPanel.classList.remove('hidden');
    }

    function hidePasscodeEntry() {
        pinEntryPanel.classList.add('hidden');
        lockAuthPanel.classList.remove('hidden');
    }

    function updatePinDots() {
        for (let i = 0; i < pinDots.length; i++) {
            pinDots[i].classList.toggle('filled', i < state.pinInput.length);
        }
    }

    function handlePinKey(key) {
        if (key === 'clear') {
            state.pinInput = state.pinInput.slice(0, -1);
        } else if (key === 'ok') {
            if (state.pinInput === state.pin) {
                unlockPhone();
                showToast('Unlocked GSO Phone');
            } else {
                showToast('Incorrect PIN');
                state.pinInput = '';
                logEvent('PIN incorrect');
            }
        } else {
            if (state.pinInput.length < 4 && /^[0-9]$/.test(key)) {
                state.pinInput += key;
            }
        }
        updatePinDots();
    }

    function ensureAppOrder() {
        if (!state.appOrder || !Array.isArray(state.appOrder)) {
            state.appOrder = apps.map(a => a.id);
        } else {
            const knownIds = new Set(apps.map(a => a.id));
            state.appOrder = state.appOrder.filter(id => knownIds.has(id));
            apps.forEach(a => {
                if (!state.appOrder.includes(a.id)) state.appOrder.push(a.id);
            });
        }
    }

    function getBrandClass(appId) {
        const map = {
            browser: 'brand-chrome',
            gsoMail: 'brand-gmail',
            googleDrive: 'brand-drive',
            maps: 'brand-maps',
            store: 'brand-play',
            samsungHealth: 'brand-s-health',
            samsungInternet: 'brand-s-internet',
            samsungNotes: 'brand-s-notes',
            oneUiHome: 'brand-oneui',
            miuiGallery: 'brand-miui'
        };
        return map[appId] || '';
    }

    function renderApps() {
        ensureAppOrder();
        appGrid.innerHTML = '';
        dock.innerHTML = '';
        appPager.innerHTML = '';

        const orderMap = {};
        state.appOrder.forEach((id, idx) => orderMap[id] = idx);

        const sortedApps = [...apps].filter(a => !a.devOnly || state.devMode).sort((a, b) => orderMap[a.id] - orderMap[b.id]);
        const installedStoreApps = storeApps.filter(app => state.storeInstalled[app.id]).map(app => ({
            id: app.id,
            name: app.name,
            icon: app.icon || '‚òÖ',
            type: 'tools',
            dock: false
        }));
        const homeApps = [...sortedApps.filter(app => !app.dock), ...installedStoreApps];

        const totalPages = Math.max(1, Math.ceil(homeApps.length / APPS_PER_PAGE));
        if (state.homePage >= totalPages) state.homePage = totalPages - 1;
        if (state.homePage < 0) state.homePage = 0;

        const pageStart = state.homePage * APPS_PER_PAGE;
        const pageApps = homeApps.slice(pageStart, pageStart + APPS_PER_PAGE);

        pageApps.forEach(app => {
            const icon = document.createElement('div');
            icon.className = 'app-icon';
            icon.dataset.appId = app.id;
            icon.draggable = true;
            icon.innerHTML = `
                <div class="app-icon-circle ${app.type} ${getBrandClass(app.id)}">
                    <span>${app.icon}</span>
                </div>
                <div>${app.name}</div>
            `;
            appGrid.appendChild(icon);
        });

        sortedApps.forEach(app => {
            if (app.dock) {
                const dockIcon = document.createElement('div');
                dockIcon.className = 'app-icon';
                dockIcon.dataset.appId = app.id;
                dockIcon.draggable = false;
                dockIcon.innerHTML = `
                    <div class="app-icon-circle ${app.type} ${getBrandClass(app.id)}">
                        <span>${app.icon}</span>
                    </div>
                    <div>${app.name}</div>
                `;
                dock.appendChild(dockIcon);
            }
        });

        if (totalPages > 1) {
            for (let i = 0; i < totalPages; i++) {
                const dot = document.createElement('button');
                dot.className = 'pager-dot' + (i === state.homePage ? ' active' : '');
                dot.setAttribute('aria-label', `Go to page ${i + 1}`);
                dot.onclick = () => {
                    state.homePage = i;
                    saveState();
                    renderApps();
                };
                appPager.appendChild(dot);
            }
        }

        initAppDragAndDrop();
    }

    let dragSourceId = null;

    function initAppDragAndDrop() {
        appGrid.querySelectorAll('.app-icon').forEach(icon => {
            icon.addEventListener('dragstart', e => {
                dragSourceId = icon.dataset.appId;
                e.dataTransfer.effectAllowed = 'move';
                icon.style.opacity = '0.4';
            });
            icon.addEventListener('dragend', () => {
                icon.style.opacity = '1';
            });
            icon.addEventListener('dragover', e => {
                e.preventDefault();
                icon.classList.add('drag-over');
            });
            icon.addEventListener('dragleave', () => {
                icon.classList.remove('drag-over');
            });
            icon.addEventListener('drop', e => {
                e.preventDefault();
                icon.classList.remove('drag-over');
                const targetId = icon.dataset.appId;
                if (!dragSourceId || dragSourceId === targetId) return;
                const order = state.appOrder;
                const fromIndex = order.indexOf(dragSourceId);
                const toIndex = order.indexOf(targetId);
                if (fromIndex === -1 || toIndex === -1) return;
                order.splice(fromIndex, 1);
                order.splice(toIndex, 0, dragSourceId);
                state.appOrder = order;
                saveState();
                logEvent('App reordered: ' + dragSourceId + ' -> ' + targetId);
                renderApps();
            });
        });
    }

    function openApp(appId) {
        if (!state.poweredOn || state.sleeping) return;
        if (state.locked) {
            showToast('Unlock phone to open apps');
            return;
        }
        state.currentApp = appId;
        setActiveScreen(appScreen);
        renderApp(appId);
        addToRecents(appId);
        logEvent('Open app: ' + appId);
        if (state.devDebugFlashes) {
            phoneScreen.classList.add('dev-flash');
            setTimeout(() => phoneScreen.classList.remove('dev-flash'), 150);
        }
    }

    function addToRecents(appId) {
        state.recents = state.recents.filter(id => id !== appId);
        state.recents.unshift(appId);
        if (state.recents.length > 5) state.recents.pop();
    }

    function renderRecents() {
        if (state.recents.length === 0) {
            showToast('No recent apps');
            return;
        }
        let msg = 'Recent apps: ';
        msg += state.recents.map(id => {
            const app = apps.find(a => a.id === id) || storeApps.find(a => a.id === id);
            return app ? app.name : id;
        }).join(', ');
        showToast(msg, 2000);
    }

    function renderApp(appId) {
        const app = apps.find(a => a.id === appId) || storeApps.find(a => a.id === appId);
        appTitle.textContent = app ? app.name : 'App';
        appBody.innerHTML = '';

        switch (appId) {
            case 'phone':
                renderPhoneApp();
                break;
            case 'messages':
                renderMessagesApp();
                break;
            case 'contacts':
                renderContactsApp();
                break;
            case 'camera':
                renderCameraApp();
                break;
            case 'gallery':
                renderGalleryApp();
                break;
            case 'browser':
                renderBrowserApp();
                break;
            case 'music':
                renderMusicApp();
                break;
            case 'maps':
                renderMapsApp();
                break;
            case 'files':
                renderFilesApp();
                break;
            case 'notes':
                renderNotesApp();
                break;
            case 'calendar':
                renderCalendarApp();
                break;
            case 'clock':
                renderClockApp();
                break;
            case 'calculator':
                renderCalculatorApp();
                break;
            case 'recorder':
                renderRecorderApp();
                break;
            case 'alarm':
                renderAlarmApp();
                break;
            case 'settings':
                renderSettingsApp();
                break;
            case 'store':
                renderStoreApp();
                break;
            case 'virusPrank':
                renderVirusPrankApp();
                break;
            case 'gsDefence':
                renderGsDefenceApp();
                break;
            case 'wannaCrySim':
                renderWannaCrySimApp();
                break;
            case 'gamesHub':
                renderGamesHubApp();
                break;
            case 'socialPlus':
                renderSocialPlusApp();
                break;
            case 'cryptoWatch':
                renderCryptoWatchApp();
                break;
            case 'weatherPro':
                renderWeatherProApp();
                break;
            case 'gsoMail':
                renderGsoMailApp();
                break;
            case 'googleDrive':
                renderGoogleDriveApp();
                break;
            case 'samsungHealth':
                renderSamsungHealthApp();
                break;
            case 'samsungInternet':
                renderSamsungInternetApp();
                break;
            case 'samsungNotes':
                renderSamsungNotesApp();
                break;
            case 'galaxyThemes':
                renderGalaxyThemesApp();
                break;
            case 'oneUiHome':
                renderOneUiHomeApp();
                break;
            case 'miuiGallery':
                renderMiuiGalleryApp();
                break;
            case 'replicaLab':
                renderReplicaLabApp();
                break;
            case 'sysLogs':
                renderSysLogsApp();
                break;
            case 'uiTuner':
                renderUiTunerApp();
                break;
            case 'experiments':
                renderExperimentsApp();
                break;
            default:
                appBody.innerHTML = '<p>This app is simulated but has no UI yet.</p>';
        }
        appBody.classList.remove('animate-in');
        requestAnimationFrame(() => appBody.classList.add('animate-in'));
    }

    function renderPhoneApp() {
        appBody.innerHTML = `
            <div class="app-section-title">Fake call controls</div>
            <div class="call-screen">
                <div class="call-name" id="callName">Unknown Caller</div>
                <div class="call-status" id="callStatus">No active call</div>
                <div class="call-controls">
                    <button class="call-btn fake" id="btnFakeIncoming">Fake call</button>
                    <button class="call-btn accept" id="btnAcceptCall">‚úì</button>
                    <button class="call-btn decline" id="btnDeclineCall">‚úï</button>
                </div>
            </div>
            <div class="app-section-title" style="margin-top:16px;">Recent fake calls</div>
            <div id="callLog">
                <div class="list-item">
                    <div class="list-item-title">GSO Support</div>
                    <div class="list-item-sub">Today ‚Ä¢ 0:00 ‚Ä¢ Missed (fake)</div>
                </div>
                <div class="list-item">
                    <div class="list-item-title">Unknown</div>
                    <div class="list-item-sub">Yesterday ‚Ä¢ 0:00 ‚Ä¢ Incoming (fake)</div>
                </div>
            </div>
        `;

        const callName = document.getElementById('callName');
        const callStatus = document.getElementById('callStatus');
        const btnFakeIncoming = document.getElementById('btnFakeIncoming');
        const btnAcceptCall = document.getElementById('btnAcceptCall');
        const btnDeclineCall = document.getElementById('btnDeclineCall');

        let callInterval = null;

        function resetCall() {
            state.fakeCallActive = false;
            state.fakeCallTimer = 0;
            if (callInterval) clearInterval(callInterval);
            callStatus.textContent = 'No active call';
            callName.textContent = 'Unknown Caller';
        }

        btnFakeIncoming.onclick = () => {
            if (state.fakeCallActive) {
                showToast('Call already active');
                return;
            }
            state.fakeCallActive = true;
            state.fakeCallTimer = 0;
            callName.textContent = 'GSO System';
            callStatus.textContent = 'Incoming call‚Ä¶';
            showToast('Incoming fake call');
            logEvent('Fake call incoming');
        };

        btnAcceptCall.onclick = () => {
            if (!state.fakeCallActive) {
                showToast('No call to accept');
                return;
            }
            callStatus.textContent = 'In call: 0:00';
            if (callInterval) clearInterval(callInterval);
            callInterval = setInterval(() => {
                state.fakeCallTimer++;
                const m = Math.floor(state.fakeCallTimer / 60).toString().padStart(1, '0');
                const s = (state.fakeCallTimer % 60).toString().padStart(2, '0');
                callStatus.textContent = `In call: ${m}:${s}`;
            }, 1000);
            logEvent('Fake call accepted');
        };

        btnDeclineCall.onclick = () => {
            if (!state.fakeCallActive) {
                showToast('No call to end');
                return;
            }
            state.fakeCallActive = false;
            state.fakeCallTimer = 0;
            if (callInterval) clearInterval(callInterval);
            callStatus.textContent = 'Call ended (fake)';
            logEvent('Fake call ended');
            setTimeout(resetCall, 1500);
        };
    }

    function renderMessagesApp() {
        appBody.innerHTML = `
            <div class="app-section-title">Conversations</div>
            <div id="messagesList"></div>
            <div class="messages-input-row">
                <input type="text" id="messageInput" placeholder="Type a message‚Ä¶">
                <button id="btnSendMessage">Send</button>
            </div>
            <div class="sleep-hint">Messages are stored locally in this browser only.</div>
        `;
        const list = document.getElementById('messagesList');
        const input = document.getElementById('messageInput');
        const btnSend = document.getElementById('btnSendMessage');

        function renderMessages() {
            list.innerHTML = '';
            if (state.messages.length === 0) {
                const empty = document.createElement('div');
                empty.className = 'list-item';
                empty.innerHTML = `
                    <div class="list-item-title">GSO System</div>
                    <div class="list-item-sub">"This is a fake SMS. Nothing leaves your browser."</div>
                `;
                list.appendChild(empty);
            } else {
                state.messages.forEach(msg => {
                    const item = document.createElement('div');
                    item.className = 'list-item';
                    item.innerHTML = `
                        <div class="list-item-title">${msg.from}</div>
                        <div class="list-item-sub">${msg.text}</div>
                    `;
                    list.appendChild(item);
                });
            }
        }

        renderMessages();

        btnSend.onclick = () => {
            const text = input.value.trim();
            if (!text) return;
            state.messages.push({ from: 'You', text });
            saveState();
            input.value = '';
            renderMessages();
            logEvent('Message sent: ' + text);
        };

        input.addEventListener('keydown', e => {
            if (e.key === 'Enter') {
                e.preventDefault();
                btnSend.click();
            }
        });
    }


    function renderContactsApp() {
        appBody.innerHTML = `
            <div class="app-section-title">Contacts</div>
            <div class="list-item"><div class="list-item-title">Alex Rivera</div><div class="list-item-sub">+1 (555) 010-1201</div></div>
            <div class="list-item"><div class="list-item-title">Jamie Chen</div><div class="list-item-sub">+1 (555) 010-4410</div></div>
            <div class="list-item"><div class="list-item-title">Morgan Patel</div><div class="list-item-sub">+1 (555) 010-8872</div></div>
            <button class="btn btn-secondary" id="btnAddContact" style="margin-top:8px;">Add contact (simulated)</button>
            <div class="sleep-hint">Manage your contacts list in this demo UI.</div>
        `;
        document.getElementById('btnAddContact').onclick = () => {
            showToast('New contact saved (simulated)');
            logEvent('Contacts: added simulated contact');
        };
    }

    function renderCameraApp() {
        appBody.innerHTML = `
            <div class="camera-preview" id="cameraPreview">
                <div class="camera-overlay-text">Fake live preview ‚Ä¢ Scene: GSO‚ÄëCity</div>
            </div>
            <div class="camera-controls">
                <div class="camera-mode">PHOTO</div>
                <button class="camera-shutter" id="btnShutter"></button>
                <div class="camera-mode">VIDEO</div>
            </div>
            <div class="app-section-title" style="margin-top:10px;">Info</div>
            <div style="font-size:11px;opacity:0.8;">
                This camera does not access your real camera. Captured photos are generated placeholders stored in the fake gallery.
            </div>
        `;
        const btnShutter = document.getElementById('btnShutter');
        const preview = document.getElementById('cameraPreview');
        btnShutter.onclick = () => {
            preview.style.transform = 'scale(0.97)';
            setTimeout(() => preview.style.transform = 'scale(1)', 120);
            state.galleryPhotos++;
            state.storageUsed = Math.min(99, state.storageUsed + 1);
            saveState();
            showToast('Captured fake photo');
            logEvent('Fake photo captured');
        };
    }

    function renderGalleryApp() {
        appBody.innerHTML = `
            <div class="app-section-title">Gallery / Photos</div>
            <div style="font-size:11px;opacity:0.8;margin-bottom:6px;">
                Photos shown here are generated by the simulator. No real images are stored.
            </div>
            <div class="gallery-grid" id="galleryGrid"></div>
            <div class="sleep-hint" id="galleryHint" style="margin-top:6px;">Tap any photo to view details.</div>
        `;
        const grid = document.getElementById('galleryGrid');
        const hint = document.getElementById('galleryHint');
        const count = Math.max(3, state.galleryPhotos);
        for (let i = 0; i < count; i++) {
            const item = document.createElement('div');
            item.className = 'gallery-item';
            item.textContent = 'GSO Shot #' + (i + 1);
            item.onclick = () => {
                hint.textContent = `Viewing GSO Shot #${i + 1} ‚Ä¢ Resolution: 1080x1920 (simulated)`;
                showToast('Opened photo #' + (i + 1));
            };
            grid.appendChild(item);
        }
    }

    function renderBrowserApp() {
        appBody.innerHTML = `
            <div class="app-section-title">Google Chrome (simulated)</div>
            <div class="error-banner">
                Chrome-style address bar. Type a URL or search term to open in a new tab.
            </div>
            <div class="browser-input-row">
                <input type="text" id="browserUrl" placeholder="Search or type web address">
                <button id="btnOpenUrl" style="background:var(--android-blue);color:#fff;border:none;border-radius:10px;padding:0 10px;">Open</button>
            </div>
            <div class="list-item">
                <div class="list-item-title">Tips</div>
                <div class="list-item-sub">URLs open in your real browser tab. History is not stored here.</div>
            </div>
            <div class="list-item">
                <div class="list-item-title">Quick links</div>
                <div class="list-item-sub">
                    <span class="pill" data-url="https://www.google.com">Google</span>
                    <span class="pill" data-url="https://www.wikipedia.org">Wikipedia</span>
                    <span class="pill" data-url="https://www.youtube.com">YouTube</span>
                </div>
            </div>
        `;
        const input = document.getElementById('browserUrl');
        const btnOpen = document.getElementById('btnOpenUrl');
        const pills = appBody.querySelectorAll('.pill[data-url]');

        function openUrl(url) {
            if (!url) return;
            let finalUrl = url.trim();
            if (!/^https?:\/\//i.test(finalUrl)) {
                finalUrl = 'https://' + finalUrl;
            }
            window.open(finalUrl, '_blank');
            logEvent('Browser open: ' + finalUrl);
        }

        btnOpen.onclick = () => {
            openUrl(input.value);
        };

        input.addEventListener('keydown', e => {
            if (e.key === 'Enter') {
                e.preventDefault();
                openUrl(input.value);
            }
        });

        pills.forEach(p => {
            p.style.cursor = 'pointer';
            p.onclick = () => {
                openUrl(p.dataset.url);
            };
        });
    }

    function renderMusicApp() {
        appBody.innerHTML = `
            <div class="app-section-title">Now playing</div>
            <div class="list-item">
                <div class="list-item-title">"Synthetic Dreams"</div>
                <div class="list-item-sub">Artist: GSO Synth Lab</div>
                <div class="pill">Status: Pretending to play</div>
            </div>
            <audio id="gsoAudio" src="https://upload.wikimedia.org/wikipedia/commons/transcoded/4/45/Beep-09.ogg/Beep-09.ogg.mp3"></audio>
            <div class="app-section-title" style="margin-top:10px;">Controls</div>
            <div style="display:flex;gap:8px;margin-top:4px;">
                <button class="btn btn-secondary" style="flex:1;" id="btnPrevTrack">‚èÆ</button>
                <button class="btn btn-secondary" style="flex:1;" id="btnPlayPause">‚ñ∂</button>
                <button class="btn btn-secondary" style="flex:1;" id="btnNextTrack">‚è≠</button>
            </div>
            <div class="sleep-hint">This plays a tiny beep so the player actually does something.</div>
        `;
        const btnPlayPause = document.getElementById('btnPlayPause');
        const audio = document.getElementById('gsoAudio');
        let playing = false;
        btnPlayPause.onclick = () => {
            playing = !playing;
            btnPlayPause.textContent = playing ? '‚è∏' : '‚ñ∂';
            if (playing) {
                audio.currentTime = 0;
                audio.play().catch(() => {});
                showToast('Playing tiny beep');
                logEvent('Music play');
            } else {
                audio.pause();
                showToast('Paused');
                logEvent('Music pause');
            }
        };
    }

    function renderMapsApp() {
        appBody.innerHTML = `
            <div class="map-box">
                <div class="map-marker" id="mapMarker"></div>
                <div class="map-label" id="mapLabel">Locating‚Ä¶</div>
            </div>
            <div class="app-section-title">Google Maps (simulated)</div>
            <div style="font-size:11px;opacity:0.8;">
                Location is simulated and cycles through several GSO‚ÄëCity landmarks. No real GPS is used here.
            </div>
            <div style="margin-top:8px;">
                <span class="mini-chip">Mode: Simulation</span>
                <span class="mini-chip">Accuracy: 0 m (imaginary)</span>
            </div>
        `;
        const marker = document.getElementById('mapMarker');
        const label = document.getElementById('mapLabel');
        const x = 20 + Math.random() * 60;
        const y = 20 + Math.random() * 60;
        marker.style.left = x + '%';
        marker.style.top = y + '%';
        marker.style.transform = 'translate(-50%, -50%)';
        label.textContent = state.fakeLocations[state.fakeLocationIndex];
        state.fakeLocationIndex = (state.fakeLocationIndex + 1) % state.fakeLocations.length;
        logEvent('Maps fake location: ' + label.textContent);
    }

    function renderFilesApp() {
        appBody.innerHTML = `
            <div class="app-section-title">Storage</div>
            <div style="font-size:11px;opacity:0.8;">
                Storage usage is simulated based on your fake photos and apps.
            </div>
            ${state.ransomwareActive ? '<div style="margin-top:6px; font-size:11px; color:#ffaaaa;">‚ö†Ô∏è WannaCry Sim is active: files are shown as locked until removed.</div>' : ''}
            <div class="storage-bar">
                <div class="storage-fill" id="storageFill"></div>
            </div>
            <div style="font-size:11px;margin-top:4px;">
                Used: <span id="storageUsedLabel"></span> / 128 GB (fake)
            </div>
            <div class="app-section-title" style="margin-top:10px;">Export</div>
            <div class="list-item">
                <div class="list-item-title">Download state snapshot</div>
                <div class="list-item-sub">Save a JSON file of your GSO Phone state.</div>
            </div>
            <button class="btn btn-secondary" id="btnExportState" style="margin-top:6px;">Download JSON</button>

            <div class="app-section-title" style="margin-top:10px;">Local files (simulated)</div>
            <div class="list-item" style="border-color:rgba(255,80,80,0.45); background:rgba(120,10,10,0.2);">
                <div class="list-item-title">ü¶† FakeVirushtml.txt</div>
                <div class="list-item-sub">Harmless HTML/CSS/JS demo file with fake-virus style UI</div>
            </div>
            <button class="btn btn-secondary" id="btnOpenVirusFile" style="margin-top:6px;">Open FakeVirushtml.txt</button>
            <button class="btn btn-secondary" id="btnDownloadVirusFile" style="margin-top:6px;">Download FakeVirushtml.txt</button>
            <div id="virusFilePanel" style="display:none; margin-top:8px; padding:10px; border-radius:10px; border:1px dashed rgba(255,80,80,0.55); background:rgba(60,0,0,0.35); color:#ffb3b3;">
                <div style="font-weight:700; text-align:center; animation: virusBlink 0.6s infinite;">SIMULATED THREAT FILE DETECTED</div>
                <div style="font-size:11px; margin-top:6px; opacity:0.95;">Loaded from FakeVirushtml.txt. This is only HTML, CSS, and JavaScript for UI testing.</div>
                <pre id="virusFilePreview" style="margin-top:8px; white-space:pre-wrap; font-size:10px; max-height:120px; overflow:auto; background:rgba(0,0,0,0.35); border-radius:8px; padding:8px;"></pre>
            </div>
        `;
        const storageFill = document.getElementById('storageFill');
        const storageUsedLabel = document.getElementById('storageUsedLabel');
        storageFill.style.width = state.storageUsed + '%';
        const usedGB = (128 * state.storageUsed / 100).toFixed(1);
        storageUsedLabel.textContent = usedGB + ' GB';

        const btnExport = document.getElementById('btnExportState');
        const btnOpenVirusFile = document.getElementById('btnOpenVirusFile');
        const btnDownloadVirusFile = document.getElementById('btnDownloadVirusFile');
        const virusFilePanel = document.getElementById('virusFilePanel');
        const virusFilePreview = document.getElementById('virusFilePreview');
        const fakeVirusHtmlFile = `<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fake Virus Alert (Simulation)</title>
<style>
  body {
    margin: 0;
    font-family: system-ui, sans-serif;
    background: #130404;
    color: #ffd2d2;
    display: grid;
    place-items: center;
    min-height: 100vh;
  }
  .panel {
    width: min(460px, 92vw);
    border: 1px dashed rgba(255, 80, 80, 0.65);
    border-radius: 12px;
    padding: 14px;
    background: rgba(150, 20, 20, 0.18);
  }
  .title {
    text-align: center;
    font-weight: 800;
    letter-spacing: .04em;
    animation: blink .6s infinite;
  }
  @keyframes blink {
    0%, 100% { opacity: .55; }
    50% { opacity: 1; }
  }
</style>
</head>
<body>
  <div class="panel">
    <div class="title">SIMULATED VIRUS FILE</div>
    <p>This is a harmless UI demo file for GSO Phone.</p>
    <button onclick="alert('No real malware. Demo only ‚úÖ')">Run fake scan</button>
  </div>
</body>
</html>`;
        btnExport.onclick = () => {
            const data = JSON.stringify(state, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'gso-phone-state.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            logEvent('State exported as JSON');
        };

        btnOpenVirusFile.onclick = () => {
            virusFilePanel.style.display = 'block';
            virusFilePreview.textContent = fakeVirusHtmlFile;
            showToast('FakeVirushtml.txt opened (simulated)');
            logEvent('Files: FakeVirushtml.txt opened (simulated)');
        };

        btnDownloadVirusFile.onclick = () => {
            const blob = new Blob([fakeVirusHtmlFile], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'FakeVirushtml.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showToast('FakeVirushtml.txt downloaded');
            logEvent('Files: FakeVirushtml.txt downloaded');
        };
    }

    function renderNotesApp() {
        appBody.innerHTML = `
            <div class="app-section-title">Quick note</div>
            <textarea id="noteArea" style="width:100%;height:120px;border-radius:10px;border:none;padding:6px;font-size:12px;background:rgba(255,255,255,0.05);color:#fff;resize:none;"></textarea>
            <div class="sleep-hint">Stored locally in your browser. Clear storage to erase.</div>
        `;
        const noteArea = document.getElementById('noteArea');
        noteArea.value = state.notesText || '';
        noteArea.addEventListener('input', () => {
            state.notesText = noteArea.value;
            saveState();
        });
    }

    function renderCalendarApp() {
        appBody.innerHTML = `
            <div class="app-section-title">Today</div>
            <input id="calendarEventInput" placeholder="New event title" style="width:100%;padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.2);background:rgba(255,255,255,0.06);color:#fff;" />
            <button class="btn btn-secondary" id="btnAddCalendarEvent" style="margin-top:6px;">Add event</button>
            <div id="calendarEventsList" style="margin-top:8px;"></div>
        `;
        if (!Array.isArray(state.fakeEventsList)) state.fakeEventsList = [];
        const input = document.getElementById('calendarEventInput');
        const list = document.getElementById('calendarEventsList');
        const draw = () => {
            list.innerHTML = '';
            if (!state.fakeEventsList.length) {
                list.innerHTML = '<div class="list-item"><div class="list-item-title">No real events</div><div class="list-item-sub">You are free to simulate anything.</div></div>';
                return;
            }
            state.fakeEventsList.forEach((ev, i) => {
                const row = document.createElement('div');
                row.className = 'list-item';
                row.innerHTML = `<div class="list-item-title">${ev}</div><div class="list-item-sub">Tap to remove</div>`;
                row.onclick = () => { state.fakeEventsList.splice(i,1); saveState(); draw(); };
                list.appendChild(row);
            });
        };
        document.getElementById('btnAddCalendarEvent').onclick = () => {
            const v = input.value.trim();
            if (!v) return showToast('Enter an event name');
            state.fakeEventsList.push(v);
            input.value = '';
            saveState();
            draw();
            showToast('Event added');
        };
        draw();
    }

    function renderClockApp() {
        appBody.innerHTML = `
            <div class="app-section-title">Clock</div>
            <div class="list-item"><div class="list-item-title" id="clockNow" style="font-size:24px;">--:--:--</div><div class="list-item-sub" id="clockDateLine">Loading date...</div></div>
            <div class="sleep-hint">World clock and stopwatch are simulated.</div>
        `;
        const nowEl = document.getElementById('clockNow');
        const dateEl = document.getElementById('clockDateLine');
        function tick() {
            if (state.currentApp !== 'clock') return;
            const d = new Date();
            nowEl.textContent = d.toLocaleTimeString();
            dateEl.textContent = d.toLocaleDateString(undefined, { weekday: 'long', month: 'long', day: 'numeric' });
            setTimeout(tick, 1000);
        }
        tick();
    }

    function renderCalculatorApp() {
        appBody.innerHTML = `
            <div class="app-section-title">Calculator</div>
            <input id="calcDisplay" value="" readonly style="width:100%;padding:10px;border-radius:10px;border:none;background:rgba(255,255,255,0.1);color:#fff;font-size:20px;text-align:right;" />
            <div id="calcGrid" style="display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-top:8px;"></div>
        `;
        const keys = ['7','8','9','/','4','5','6','*','1','2','3','-','0','.','=','+'];
        const grid = document.getElementById('calcGrid');
        const disp = document.getElementById('calcDisplay');
        keys.forEach(k => {
            const b = document.createElement('button');
            b.className = 'btn btn-secondary';
            b.textContent = k;
            b.onclick = () => {
                if (k === '=') {
                    try { disp.value = String(Function('return (' + (disp.value || '0') + ')')()); } catch { disp.value = 'Error'; }
                    return;
                }
                disp.value += k;
            };
            grid.appendChild(b);
        });
    }

    function renderRecorderApp() {
        appBody.innerHTML = `
            <div class="app-section-title">Voice Recorder</div>
            <button class="btn btn-secondary" id="btnRecordMemo" style="width:100%;">Record memo (simulated)</button>
            <div id="memoList" style="margin-top:8px;"></div>
        `;
        const list = document.getElementById('memoList');
        function draw() {
            list.innerHTML = '';
            if (!state.voiceMemos.length) {
                list.innerHTML = '<div class="sleep-hint">No recordings yet.</div>';
                return;
            }
            state.voiceMemos.slice().reverse().forEach(m => {
                const row = document.createElement('div');
                row.className = 'list-item';
                row.innerHTML = `<div class="list-item-title">${m.name}</div><div class="list-item-sub">${m.time}</div>`;
                list.appendChild(row);
            });
        }
        document.getElementById('btnRecordMemo').onclick = () => {
            const d = new Date();
            state.voiceMemos.push({ name: 'Memo #' + (state.voiceMemos.length + 1), time: d.toLocaleTimeString() });
            if (state.voiceMemos.length > 20) state.voiceMemos.shift();
            saveState();
            showToast('Voice memo saved (simulated)');
            draw();
        };
        draw();
    }

    function renderAlarmApp() {
        appBody.innerHTML = `
            <div class="app-section-title">Alarm</div>
            <input id="alarmInput" type="time" style="width:100%;padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.2);background:rgba(255,255,255,0.06);color:#fff;" />
            <button class="btn btn-secondary" id="btnAddAlarm" style="margin-top:6px;width:100%;">Add alarm</button>
            <div id="alarmList" style="margin-top:8px;"></div>
        `;
        const list = document.getElementById('alarmList');
        function draw() {
            list.innerHTML = '';
            if (!state.fakeAlarms.length) {
                list.innerHTML = '<div class="sleep-hint">No alarms set.</div>';
                return;
            }
            state.fakeAlarms.forEach((a, i) => {
                const row = document.createElement('div');
                row.className = 'list-item';
                row.innerHTML = `<div class="list-item-title">${a}</div><div class="list-item-sub">Daily ‚Ä¢ simulated</div>`;
                row.onclick = () => { state.fakeAlarms.splice(i,1); saveState(); draw(); };
                list.appendChild(row);
            });
        }
        document.getElementById('btnAddAlarm').onclick = () => {
            const v = document.getElementById('alarmInput').value;
            if (!v) return showToast('Pick a time first');
            state.fakeAlarms.push(v);
            saveState();
            showToast('Alarm added');
            draw();
        };
        draw();
    }

    function renderSettingsApp() {
        appBody.innerHTML = `
            <div class="app-section-title">Network & connectivity</div>
            <div class="settings-row">
                <div class="settings-label">Wi‚ÄëFi</div>
                <div class="toggle ${state.wifiOn ? 'on' : ''}" id="toggleWifi"><div class="toggle-knob"></div></div>
            </div>
            <div class="settings-row">
                <div class="settings-label">Bluetooth</div>
                <div class="toggle ${state.btOn ? 'on' : ''}" id="toggleBt"><div class="toggle-knob"></div></div>
            </div>
            <div class="settings-row">
                <div class="settings-label">Airplane mode</div>
                <div class="toggle ${state.airplane ? 'on' : ''}" id="toggleAirplane"><div class="toggle-knob"></div></div>
            </div>

            <div class="app-section-title">Battery</div>
            <div class="settings-row">
                <div class="settings-label">Battery Saver</div>
                <div class="toggle ${state.batterySaver ? 'on' : ''}" id="toggleBatterySaver"><div class="toggle-knob"></div></div>
            </div>
            <div style="font-size:11px;opacity:0.8;margin-top:4px;">
                Battery: ${state.battery}% ‚Ä¢ Health: 100% (fake)
            </div>

            <div class="app-section-title">Developer options</div>
            <div class="settings-row">
                <div class="settings-label">Developer mode</div>
                <div class="toggle ${state.devMode ? 'on' : ''}" id="toggleDevMode"><div class="toggle-knob"></div></div>
            </div>
            <div style="font-size:11px;opacity:0.8;margin-top:4px;">
                When enabled, extra overlays, logs, and hidden apps become available.
            </div>

            <div class="app-section-title">Security</div>
            <div class="settings-row">
                <div class="settings-label">Fingerprint unlock</div>
                <div class="toggle ${state.fingerprintEnabled ? 'on' : ''}" id="toggleFingerprint"><div class="toggle-knob"></div></div>
            </div>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:6px; margin-top:6px;">
                <input id="currentPinInput" type="password" maxlength="4" placeholder="Current PIN" style="padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.2);background:rgba(255,255,255,0.06);color:#fff;" />
                <input id="newPinInput" type="password" maxlength="4" placeholder="New 4-digit PIN" style="padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.2);background:rgba(255,255,255,0.06);color:#fff;" />
            </div>
            <button class="btn btn-secondary" id="btnChangePin" style="margin-top:6px; width:100%;">Change passcode</button>

            <div class="app-section-title">Appearance</div>
            <div class="settings-row">
                <div class="settings-label">Dark mode</div>
                <div class="toggle ${state.darkMode ? 'on' : ''}" id="toggleDarkMode"><div class="toggle-knob"></div></div>
            </div>

            <div class="app-section-title">Wallpaper colors</div>
            <button class="btn btn-secondary" id="btnSetWpOcean" style="margin-top:6px; width:100%;">Ocean Blue wallpaper</button>
            <button class="btn btn-secondary" id="btnSetWpPurple" style="margin-top:6px; width:100%;">Purple Glow wallpaper</button>
            <button class="btn btn-secondary" id="btnSetWpDark" style="margin-top:6px; width:100%;">Dark Night wallpaper</button>
            <button class="btn btn-secondary" id="btnSetWpCoral" style="margin-top:6px; width:100%;">Coral Burst wallpaper</button>
            <button class="btn btn-secondary" id="btnSetWpMint" style="margin-top:6px; width:100%;">Mint Wave wallpaper</button>
            <div class="sleep-hint">Current wallpaper: <span id="settingsWallpaperLabel">${state.wallpaper || 'ocean'}</span></div>
        `;

        const toggleWifi = document.getElementById('toggleWifi');
        const toggleBt = document.getElementById('toggleBt');
        const toggleAirplane = document.getElementById('toggleAirplane');
        const toggleBatterySaver = document.getElementById('toggleBatterySaver');
        const toggleDevMode = document.getElementById('toggleDevMode');
        const toggleFingerprint = document.getElementById('toggleFingerprint');
        const toggleDarkMode = document.getElementById('toggleDarkMode');

        toggleWifi.onclick = () => {
            state.wifiOn = !state.wifiOn;
            toggleWifi.classList.toggle('on', state.wifiOn);
            widgetStatusSub.textContent = `Battery: ${state.battery}% ‚Ä¢ Network: ${navigator.onLine && state.wifiOn ? 'Online' : 'Offline'}`;
            saveState();
            logEvent('Wi‚ÄëFi: ' + (state.wifiOn ? 'on' : 'off'));
        };
        toggleBt.onclick = () => {
            state.btOn = !state.btOn;
            toggleBt.classList.toggle('on', state.btOn);
            saveState();
            logEvent('Bluetooth: ' + (state.btOn ? 'on' : 'off'));
        };
        toggleAirplane.onclick = () => {
            state.airplane = !state.airplane;
            toggleAirplane.classList.toggle('on', state.airplane);
            if (state.airplane) {
                state.wifiOn = false;
                state.btOn = false;
                widgetStatusSub.textContent = `Battery: ${state.battery}% ‚Ä¢ Network: Airplane mode`;
                showToast('Airplane mode on');
                logEvent('Airplane mode on');
            } else {
                widgetStatusSub.textContent = `Battery: ${state.battery}% ‚Ä¢ Network: ${navigator.onLine ? 'Online' : 'Offline'}`;
                showToast('Airplane mode off');
                logEvent('Airplane mode off');
            }
            saveState();
        };
        toggleBatterySaver.onclick = () => {
            state.batterySaver = !state.batterySaver;
            toggleBatterySaver.classList.toggle('on', state.batterySaver);
            showToast(state.batterySaver ? 'Battery Saver enabled' : 'Battery Saver disabled');
            logEvent('Battery Saver: ' + (state.batterySaver ? 'on' : 'off'));
            saveState();
        };
        toggleDevMode.onclick = () => {
            state.devMode = !state.devMode;
            toggleDevMode.classList.toggle('on', state.devMode);
            showToast(state.devMode ? 'Developer mode enabled' : 'Developer mode disabled');
            logEvent('Developer mode: ' + (state.devMode ? 'on' : 'off'));
            if (state.devMode) {
                pushNotification('Developer mode', 'GSO debug: All logs are imaginary.');
            }
            applyDevOptions();
            renderApps();
            saveState();
        };

        toggleFingerprint.onclick = () => {
            state.fingerprintEnabled = !state.fingerprintEnabled;
            toggleFingerprint.classList.toggle('on', state.fingerprintEnabled);
            btnFingerprintUnlock.style.display = state.fingerprintEnabled ? 'inline-block' : 'none';
            showToast(state.fingerprintEnabled ? 'Fingerprint unlock enabled' : 'Fingerprint unlock disabled');
            saveState();
        };

        toggleDarkMode.onclick = () => {
            state.darkMode = !state.darkMode;
            toggleDarkMode.classList.toggle('on', state.darkMode);
            applyDarkMode();
            saveState();
            showToast(state.darkMode ? 'Dark mode enabled' : 'Dark mode disabled');
        };

        document.getElementById('btnChangePin').onclick = () => {
            const currentPin = document.getElementById('currentPinInput').value.trim();
            const newPin = document.getElementById('newPinInput').value.trim();
            if (currentPin !== state.pin) return showToast('Current passcode is incorrect');
            if (!/^\d{4}$/.test(newPin)) return showToast('New passcode must be 4 digits');
            state.pin = newPin;
            saveState();
            document.getElementById('currentPinInput').value = '';
            document.getElementById('newPinInput').value = '';
            showToast('Passcode changed');
            logEvent('Security: passcode changed');
        };

        function setSettingsWallpaper(key, label) {
            state.wallpaper = key;
            applyOneUiMode();
            saveState();
            document.getElementById('settingsWallpaperLabel').textContent = key;
            showToast(label + ' wallpaper applied');
            logEvent('Settings: wallpaper ' + key + ' applied');
        }

        document.getElementById('btnSetWpOcean').onclick = () => setSettingsWallpaper('ocean', 'Ocean Blue');
        document.getElementById('btnSetWpPurple').onclick = () => setSettingsWallpaper('purple', 'Purple Glow');
        document.getElementById('btnSetWpDark').onclick = () => setSettingsWallpaper('dark', 'Dark Night');
        document.getElementById('btnSetWpCoral').onclick = () => setSettingsWallpaper('coral', 'Coral Burst');
        document.getElementById('btnSetWpMint').onclick = () => setSettingsWallpaper('mint', 'Mint Wave');
    }

    function renderStoreApp() {
        appBody.innerHTML = `
            <div class="app-section-title">GS Play Store</div>
            <div class="sleep-hint" style="margin-bottom:8px;">Android-style app marketplace (simulated)</div>
            <div class="pill" style="margin-bottom:8px; border-color: rgba(26,115,232,0.55); color:#9fc2ff;">For you</div>
            <div class="app-store-grid" id="storeGrid"></div>
        `;
        const grid = document.getElementById('storeGrid');
        storeApps.forEach(app => {
            const installed = !!state.storeInstalled[app.id];
            const card = document.createElement('div');
            card.className = 'store-card';
            card.innerHTML = `
                <div style="display:flex; align-items:center;">
                    <div class="store-card-icon">${app.icon || '‚òÖ'}</div>
                    <div class="store-card-main">
                        <div class="store-card-title">${app.name}</div>
                        <div class="store-card-sub">${app.desc}</div>
                    </div>
                </div>
                <button class="store-btn ${installed ? 'installed' : ''}" data-app-id="${app.id}">
                    ${installed ? 'Installed' : 'Install'}
                </button>
            `;
            grid.appendChild(card);
        });

        grid.querySelectorAll('.store-btn').forEach(btn => {
            btn.onclick = () => {
                const id = btn.dataset.appId;
                const app = storeApps.find(a => a.id === id);
                if (!app) return;
                if (state.storeInstalled[id]) {
                    showToast(app.name + ' already installed');
                } else {
                    state.storeInstalled[id] = true;
                    state.storageUsed = Math.min(99, state.storageUsed + 2);
                    btn.textContent = 'Installed';
                    btn.classList.add('installed');
                    renderApps();
                    saveState();
                    showToast('Installed ' + app.name);
                    logEvent('Store install: ' + app.name);
                }
            };
        });
    }

    function renderGamesHubApp() {
        appBody.innerHTML = `
            <div class="app-section-title">GSO Games Hub</div>
            <div class="list-item" style="margin-bottom:8px;">
                <div class="list-item-title">‚ö° Tap Sprint</div>
                <div class="list-item-sub">Tap as fast as you can for 5 seconds.</div>
            </div>
            <button class="btn btn-secondary" id="btnStartTapGame">Start Tap Sprint</button>
            <div class="sleep-hint" id="tapGameStatus" style="margin-top:6px;">Best score: ${state.gameTapBest}</div>

            <div class="list-item" style="margin-top:10px; margin-bottom:8px;">
                <div class="list-item-title">üî¢ Number Guess</div>
                <div class="list-item-sub">Guess a number from 1 to 20.</div>
            </div>
            <input id="guessInput" type="number" min="1" max="20" placeholder="1-20" style="width:100%; padding:8px; border-radius:10px; border:1px solid rgba(255,255,255,0.2); background:rgba(255,255,255,0.06); color:#fff;" />
            <button class="btn btn-secondary" id="btnGuessNumber" style="margin-top:6px;">Submit guess</button>
            <button class="btn btn-secondary" id="btnNewGuessRound" style="margin-top:6px;">New round</button>
            <div class="sleep-hint" id="guessGameStatus" style="margin-top:6px;">Best attempts: ${state.gameGuessBest ?? 'N/A'}</div>

            <div class="list-item" style="margin-top:10px;">
                <div class="list-item-title">üß© Quick Match</div>
                <div class="list-item-sub" id="matchPrompt">Find the matching emoji in 3 choices.</div>
            </div>
            <div id="matchChoices" style="display:grid; grid-template-columns:repeat(3, 1fr); gap:6px; margin-top:6px;"></div>
            <div class="sleep-hint" id="matchStatus" style="margin-top:6px;">Tap any tile to play.</div>
        `;

        const btnStartTapGame = document.getElementById('btnStartTapGame');
        const tapGameStatus = document.getElementById('tapGameStatus');
        let tapScore = 0;
        let tapTimer = null;
        btnStartTapGame.onclick = () => {
            if (btnStartTapGame.dataset.running === '1') {
                tapScore += 1;
                tapGameStatus.textContent = `Score: ${tapScore}`;
                return;
            }
            tapScore = 0;
            btnStartTapGame.dataset.running = '1';
            btnStartTapGame.textContent = 'Tap now!';
            tapGameStatus.textContent = 'Score: 0';
            tapTimer = setTimeout(() => {
                btnStartTapGame.dataset.running = '0';
                btnStartTapGame.textContent = 'Start Tap Sprint';
                if (tapScore > state.gameTapBest) state.gameTapBest = tapScore;
                tapGameStatus.textContent = `Round done: ${tapScore} taps ‚Ä¢ Best: ${state.gameTapBest}`;
                saveState();
                logEvent('Games Hub: Tap Sprint score ' + tapScore);
            }, 5000);
        };

        const guessInput = document.getElementById('guessInput');
        const btnGuessNumber = document.getElementById('btnGuessNumber');
        const btnNewGuessRound = document.getElementById('btnNewGuessRound');
        const guessGameStatus = document.getElementById('guessGameStatus');
        let guessTarget = 1 + Math.floor(Math.random() * 20);
        let guessAttempts = 0;

        btnGuessNumber.onclick = () => {
            const value = Number(guessInput.value);
            if (!Number.isInteger(value) || value < 1 || value > 20) {
                guessGameStatus.textContent = 'Enter a whole number between 1 and 20.';
                return;
            }
            guessAttempts += 1;
            if (value === guessTarget) {
                if (state.gameGuessBest === null || guessAttempts < state.gameGuessBest) state.gameGuessBest = guessAttempts;
                guessGameStatus.textContent = `Correct in ${guessAttempts} attempts! Best: ${state.gameGuessBest}`;
                saveState();
                logEvent('Games Hub: Number Guess solved in ' + guessAttempts + ' attempts');
            } else if (value < guessTarget) {
                guessGameStatus.textContent = `Too low. Attempts: ${guessAttempts}`;
            } else {
                guessGameStatus.textContent = `Too high. Attempts: ${guessAttempts}`;
            }
        };

        btnNewGuessRound.onclick = () => {
            guessTarget = 1 + Math.floor(Math.random() * 20);
            guessAttempts = 0;
            guessInput.value = '';
            guessGameStatus.textContent = `New round started. Best attempts: ${state.gameGuessBest ?? 'N/A'}`;
        };

        const matchChoices = document.getElementById('matchChoices');
        const matchPrompt = document.getElementById('matchPrompt');
        const matchStatus = document.getElementById('matchStatus');
        const emojiPool = ['üçé','üöÄ','üéÆ','üê±','‚öΩ','üéµ','üß†','üåô'];

        function startMatchRound() {
            const target = emojiPool[Math.floor(Math.random() * emojiPool.length)];
            const options = [target, emojiPool[Math.floor(Math.random() * emojiPool.length)], emojiPool[Math.floor(Math.random() * emojiPool.length)]];
            options.sort(() => Math.random() - 0.5);
            matchPrompt.textContent = `Find this emoji: ${target}`;
            matchChoices.innerHTML = '';
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'btn btn-secondary';
                btn.style.padding = '10px 0';
                btn.textContent = opt;
                btn.onclick = () => {
                    if (opt === target) {
                        matchStatus.textContent = 'Correct! New round loaded.';
                        logEvent('Games Hub: Quick Match win');
                    } else {
                        matchStatus.textContent = 'Not that one. Try the next round.';
                        logEvent('Games Hub: Quick Match miss');
                    }
                    startMatchRound();
                };
                matchChoices.appendChild(btn);
            });
        }

        startMatchRound();
    }

    function renderSocialPlusApp() {
        appBody.innerHTML = `
            <div class="app-section-title">Social+</div>
            <textarea id="socialPostInput" style="width:100%;height:70px;border-radius:10px;border:none;padding:8px;background:rgba(255,255,255,0.08);color:#fff;resize:none;" placeholder="What's happening?"></textarea>
            <button class="btn btn-secondary" id="btnSocialPost" style="margin-top:6px;">Post</button>
            <div id="socialFeed" style="margin-top:8px;"></div>
            <div class="sleep-hint">No real accounts. No tracking. Just UI.</div>
        `;
        if (!Array.isArray(state.fakeSocialFeed)) state.fakeSocialFeed = ['Posting from a simulated phone.'];
        const feed = document.getElementById('socialFeed');
        const draw = () => {
            feed.innerHTML = '';
            state.fakeSocialFeed.slice().reverse().forEach(txt => {
                const item = document.createElement('div');
                item.className = 'list-item';
                item.innerHTML = `<div class="list-item-title">@you</div><div class="list-item-sub">"${txt}"</div>`;
                feed.appendChild(item);
            });
        };
        document.getElementById('btnSocialPost').onclick = () => {
            const txt = document.getElementById('socialPostInput').value.trim();
            if (!txt) return;
            state.fakeSocialFeed.push(txt);
            if (state.fakeSocialFeed.length > 20) state.fakeSocialFeed.shift();
            saveState();
            document.getElementById('socialPostInput').value = '';
            draw();
            showToast('Post published (simulated)');
        };
        draw();
    }

    function renderCryptoWatchApp() {
        const gsoPrice = (5000 + Math.random()*5000).toFixed(0);
        const simPrice = (10 + Math.random()*90).toFixed(2);
        appBody.innerHTML = `
            <div class="app-section-title">CryptoWatch</div>
            <div class="list-item">
                <div class="list-item-title">GSO‚ÄëCOIN</div>
                <div class="list-item-sub" id="gsoPrice">+${gsoPrice}% ‚Ä¢ Totally imaginary gains</div>
            </div>
            <div class="list-item">
                <div class="list-item-title">SIM‚ÄëTOKEN</div>
                <div class="list-item-sub" id="simPrice">${simPrice} GS</div>
            </div>
            <button class="btn btn-secondary" id="btnRefreshCrypto" style="margin-top:6px;">Refresh prices</button>
            <div class="sleep-hint">Prices are random and not connected to any real market.</div>
            <div class="sleep-hint" style="margin-top:4px;">Wallet: ${state.gsoCoins} GS Coin (simulated)</div>
        `;
        document.getElementById('btnRefreshCrypto').onclick = () => renderCryptoWatchApp();
    }

    function renderWeatherProApp() {
        appBody.innerHTML = `
            <div class="app-section-title">Weather Pro+</div>
            <div class="list-item">
                <div class="list-item-title">Your location</div>
                <div class="list-item-sub" id="weatherMainLine">${state.fakeWeather.toFixed(1)}¬∞C ‚Ä¢ ${state.fakeWeatherDesc}</div>
            </div>
            <div class="list-item">
                <div class="list-item-title">Source</div>
                <div class="list-item-sub">Data from open-meteo.com when available, otherwise simulated.</div>
            </div>
            <button class="btn btn-secondary" id="btnRefreshWeather" style="margin-top:6px;">Refresh weather</button>
        `;
        document.getElementById('btnRefreshWeather').onclick = () => {
            state.fakeWeather = 14 + Math.random() * 18;
            const desc = ['Clear', 'Cloudy', 'Light rain', 'Windy', 'Humid'];
            state.fakeWeatherDesc = desc[Math.floor(Math.random() * desc.length)];
            saveState();
            renderWeatherProApp();
            logEvent('WeatherPro refresh: ' + state.fakeWeather.toFixed(1) + '¬∞C');
        };
    }

    function renderGsoMailApp() {
        appBody.innerHTML = `
            <div class="app-section-title">Gmail Inbox (simulated)</div>
            <div style="margin-bottom:8px; padding:8px 10px; border-radius:999px; background:rgba(255,255,255,0.7); color:#333; font-size:11px;">üîç Search in mail</div>
            <div class="list-item">
                <div class="list-item-title">welcome@gso.phone</div>
                <div class="list-item-sub">"Thanks for trying the GSO Phone simulator."</div>
            </div>
            <div class="list-item" style="border-color: rgba(255,80,80,0.45); background: rgba(120,10,10,0.2); margin-top:8px;">
                <div class="list-item-title">security-center@gs0-alerts.biz</div>
                <div class="list-item-sub">‚ö†Ô∏è Scam email: "URGENT! Open FakeVirushtml.txt attachment now!"</div>
            </div>
            <button class="btn btn-secondary" id="btnOpenScamAttachment" style="margin-top:6px;">Open attachment (simulated scam)</button>
            <button class="btn btn-secondary" id="btnTriggerRansomware" style="margin-top:6px;">Open "invoice.zip" (ransomware demo)</button>
            <div class="sleep-hint">No emails are sent or received. Gmail-style behavior is simulated.</div>
        `;

        const btnOpenScamAttachment = document.getElementById('btnOpenScamAttachment');
        const btnTriggerRansomware = document.getElementById('btnTriggerRansomware');
        btnOpenScamAttachment.onclick = () => {
            showToast('Scam attachment opened (simulation)');
            logEvent('GSO Mail: simulated scam attachment opened');
            openApp('virusPrank');
        };

        btnTriggerRansomware.onclick = () => {
            state.ransomwareActive = true;
            saveState();
            showToast('Ransomware simulation started');
            logEvent('GSO Mail: ransomware simulation triggered');
            openApp('wannaCrySim');
        };
    }



    function renderGoogleDriveApp() {
        appBody.innerHTML = `
            <div class="app-section-title">Google Drive</div>
            <div class="list-item"><div class="list-item-title">My Drive</div><div class="list-item-sub">12 files ‚Ä¢ simulated cloud sync</div></div>
            <div class="list-item"><div class="list-item-title">Shared with me</div><div class="list-item-sub">3 documents</div></div>
            <button class="btn btn-secondary" id="btnDriveUpload" style="margin-top:8px;">Upload file (simulated)</button>
            <div class="sleep-hint">Cloud storage is simulated; no real upload happens.</div>
        `;
        document.getElementById('btnDriveUpload').onclick = () => {
            showToast('Uploaded to Drive (simulated)');
            logEvent('Google Drive: simulated upload');
        };
    }

    function renderSamsungHealthApp() {
        appBody.innerHTML = `
            <div class="app-section-title">Samsung Health</div>
            <div class="list-item"><div class="list-item-title">Steps today</div><div class="list-item-sub">${3000 + Math.floor(Math.random()*7000)} steps</div></div>
            <div class="list-item"><div class="list-item-title">Heart points</div><div class="list-item-sub">${20 + Math.floor(Math.random()*40)} pts</div></div>
            <button class="btn btn-secondary" id="btnStartWorkout" style="margin-top:6px;">Start workout</button>
            <div class="sleep-hint" id="healthHint">Health metrics are generated for demo only.</div>
        `;
        const hint = document.getElementById('healthHint');
        document.getElementById('btnStartWorkout').onclick = () => {
            hint.textContent = 'Workout running... calories and distance are simulated.';
            showToast('Workout started');
            logEvent('Samsung Health: workout started');
        };
    }


    function renderSamsungInternetApp() {
        appBody.innerHTML = `
            <div class="app-section-title">Samsung Internet</div>
            <div class="list-item"><div class="list-item-title">Privacy dashboard</div><div class="list-item-sub">Trackers blocked: ${5 + Math.floor(Math.random() * 20)}</div></div>
            <div class="list-item"><div class="list-item-title">Quick access</div><div class="list-item-sub">Samsung.com, News, Weather</div></div>
            <button class="btn btn-secondary" id="btnOpenSamsungSite" style="margin-top:6px;">Open samsung.com</button>
            <div class="sleep-hint">Browser experience is simulated.</div>
        `;
        document.getElementById('btnOpenSamsungSite').onclick = () => {
            window.open('https://www.samsung.com', '_blank');
            logEvent('Samsung Internet: open samsung.com');
        };
    }

    function renderSamsungNotesApp() {
        appBody.innerHTML = `
            <div class="app-section-title">Samsung Notes</div>
            <textarea id="samsungNoteArea" style="width:100%;height:130px;border-radius:12px;border:1px solid rgba(0,0,0,0.15);padding:8px;font-size:12px;background:rgba(255,255,255,0.72);color:#111;resize:none;" placeholder="Write a note..."></textarea>
            <button class="btn btn-secondary" id="btnSaveSamsungNote" style="margin-top:8px;">Save note (simulated)</button>
            <div class="sleep-hint">Saved locally in this simulator state.</div>
        `;
        const area = document.getElementById('samsungNoteArea');
        area.value = state.notesText || '';
        document.getElementById('btnSaveSamsungNote').onclick = () => {
            state.notesText = area.value;
            saveState();
            showToast('Samsung note saved');
            logEvent('Samsung Notes: note saved');
        };
    }

    function renderGalaxyThemesApp() {
        appBody.innerHTML = `
            <div class="app-section-title">Galaxy Themes</div>
            <div class="list-item"><div class="list-item-title">Current theme</div><div class="list-item-sub" id="galaxyThemeLabel">${state.oneUiMode ? state.galaxyTheme : 'gs-default'}</div></div>
            <div class="list-item"><div class="list-item-title">Current wallpaper</div><div class="list-item-sub" id="wallpaperLabel">${state.wallpaper || 'ocean'}</div></div>
            <button class="btn btn-secondary" id="btnThemeLight" style="margin-top:8px; width:100%;">Apply One UI Light</button>
            <button class="btn btn-secondary" id="btnThemePurple" style="margin-top:6px; width:100%;">Apply One UI Purple</button>
            <button class="btn btn-secondary" id="btnThemeDark" style="margin-top:6px; width:100%;">Apply One UI Dark</button>
            <button class="btn btn-secondary" id="btnWpOcean" style="margin-top:6px; width:100%;">Color sync: Ocean Blue</button>
            <button class="btn btn-secondary" id="btnWpPurple" style="margin-top:6px; width:100%;">Color sync: Purple Glow</button>
            <button class="btn btn-secondary" id="btnWpDark" style="margin-top:6px; width:100%;">Color sync: Dark Night</button>
            <button class="btn btn-secondary" id="btnWpCoral" style="margin-top:6px; width:100%;">Color sync: Coral Burst</button>
            <button class="btn btn-secondary" id="btnWpMint" style="margin-top:6px; width:100%;">Color sync: Mint Wave</button>
            <button class="btn btn-secondary" id="btnRestoreGsTheme" style="margin-top:6px; width:100%;">Restore GS theme</button>
            <div class="sleep-hint">Color sync makes app icons and UI use the same palette.</div>
        `;

        function applyTheme(key, toastLabel) {
            state.oneUiMode = true;
            state.galaxyTheme = key;
            applyOneUiMode();
            saveState();
            document.getElementById('galaxyThemeLabel').textContent = key;
            document.getElementById('wallpaperLabel').textContent = state.wallpaper || 'ocean';
            showToast(toastLabel + ' applied');
            logEvent('Galaxy Themes: ' + key + ' applied');
        }

        document.getElementById('btnThemeLight').onclick = () => applyTheme('oneui-light', 'One UI Light');
        document.getElementById('btnThemePurple').onclick = () => applyTheme('purple', 'One UI Purple');
        document.getElementById('btnThemeDark').onclick = () => applyTheme('dark', 'One UI Dark');

        function applyWallpaper(key, toastLabel) {
            state.wallpaper = key;
            state.colorTheme = key;
            applyOneUiMode();
            saveState();
            document.getElementById('wallpaperLabel').textContent = key;
            showToast(toastLabel + ' color sync applied');
            logEvent('Galaxy Themes: color sync ' + key + ' applied');
        }

        document.getElementById('btnWpOcean').onclick = () => applyWallpaper('ocean', 'Ocean Blue');
        document.getElementById('btnWpPurple').onclick = () => applyWallpaper('purple', 'Purple Glow');
        document.getElementById('btnWpDark').onclick = () => applyWallpaper('dark', 'Dark Night');
        document.getElementById('btnWpCoral').onclick = () => applyWallpaper('coral', 'Coral Burst');
        document.getElementById('btnWpMint').onclick = () => applyWallpaper('mint', 'Mint Wave');

        document.getElementById('btnRestoreGsTheme').onclick = () => {
            state.oneUiMode = false;
            state.colorTheme = null;
            applyOneUiMode();
            saveState();
            document.getElementById('galaxyThemeLabel').textContent = 'gs-default';
            document.getElementById('wallpaperLabel').textContent = state.wallpaper || 'ocean';
            showToast('GS OS theme restored');
            logEvent('Galaxy Themes: restored GS OS default');
        };
    }

    function renderOneUiHomeApp() {
        appBody.innerHTML = `
            <div class="app-section-title">One UI Home</div>
            <div class="list-item"><div class="list-item-title">Launcher state</div><div class="list-item-sub">${state.oneUiMode ? 'One UI override active' : 'GS OS active'}</div></div>
            <div class="list-item"><div class="list-item-title">Samsung suite</div><div class="list-item-sub">Install Samsung Health, Internet, Notes, Galaxy Themes</div></div>
            <button class="btn btn-secondary" id="btnInstallSamsungSuite" style="margin-top:8px; width:100%;">Install Samsung suite + override GS OS</button>
            <button class="btn btn-secondary" id="btnDisableOneUi" style="margin-top:6px; width:100%;">Disable One UI override</button>
        `;
        document.getElementById('btnInstallSamsungSuite').onclick = () => {
            ['samsungHealth', 'samsungInternet', 'samsungNotes', 'galaxyThemes', 'oneUiHome'].forEach(id => state.storeInstalled[id] = true);
            state.oneUiMode = true;
            if (!state.galaxyTheme) state.galaxyTheme = 'oneui-light';
            applyOneUiMode();
            renderApps();
            saveState();
            showToast('Samsung apps installed + One UI override enabled');
            logEvent('One UI Home: Samsung suite installed and GS OS overridden (simulated)');
        };
        document.getElementById('btnDisableOneUi').onclick = () => {
            state.oneUiMode = false;
            applyOneUiMode();
            saveState();
            showToast('One UI override disabled');
            logEvent('One UI Home: override disabled');
        };
    }

    function renderMiuiGalleryApp() {
        appBody.innerHTML = `
            <div class="app-section-title">MIUI Gallery</div>
            <div class="list-item"><div class="list-item-title">Recent photos</div><div class="list-item-sub">${state.galleryPhotos} captured items</div></div>
            <div class="list-item"><div class="list-item-title">Albums</div><div class="list-item-sub">Camera, Screenshots, Downloads</div></div>
            <button class="btn btn-secondary" id="btnMiuiSlideshow" style="margin-top:6px;">Start slideshow</button>
            <div class="sleep-hint" id="miuiHint">Gallery management UI inspired by MIUI, fully simulated.</div>
        `;
        const hint = document.getElementById('miuiHint');
        document.getElementById('btnMiuiSlideshow').onclick = () => {
            hint.textContent = 'Slideshow running... showing photos every 2s (simulated).';
            showToast('MIUI slideshow started');
        };
    }

    function renderReplicaLabApp() {
        appBody.innerHTML = `
            <div class="app-section-title">Replica Lab</div>
            <div class="list-item">
                <div class="list-item-title">Create profile replica (fake)</div>
                <div class="list-item-sub">Generates harmless mock identities for UI demos only.</div>
            </div>
            <button class="btn btn-secondary" id="btnGenerateReplica">Generate replica</button>
            <div id="replicaOutput" class="sleep-hint" style="margin-top:8px; white-space:pre-wrap;"></div>
        `;
        const btnGenerateReplica = document.getElementById('btnGenerateReplica');
        const replicaOutput = document.getElementById('replicaOutput');
        const names = ['Alex Mercer', 'Jordan Vega', 'Sam Carter', 'Riley Park', 'Taylor Quinn'];
        const cities = ['GSO-City', 'North Byte', 'Sim Harbor', 'Cloudview', 'Pixel Point'];
        btnGenerateReplica.onclick = () => {
            const name = names[Math.floor(Math.random() * names.length)];
            const city = cities[Math.floor(Math.random() * cities.length)];
            const id = Math.floor(100000 + Math.random() * 900000);
            replicaOutput.textContent = `Name: ${name}
City: ${city}
Demo ID: REP-${id}

This is a harmless generated profile for testing only.`;
            logEvent('Replica Lab: fake profile generated');
        };
    }


    function renderGsDefenceApp() {
        appBody.innerHTML = `
            <div class="app-section-title">GS Defence Antivirus</div>
            <div class="list-item">
                <div class="list-item-title">Engine: GS-Defender v1.0</div>
                <div class="list-item-sub">Safe simulation only. No real malware actions.</div>
            </div>
            <div class="list-item" style="margin-top:8px; border-color: rgba(255,80,80,0.45); background: rgba(120,10,10,0.18);">
                <div class="list-item-title">Ransomware status</div>
                <div class="list-item-sub" id="defenceStatus">${state.ransomwareActive ? 'Threat detected: WannaCry Sim' : 'No active ransomware simulation found.'}</div>
            </div>
            <button class="btn btn-secondary" id="btnRunDefenceScan" style="margin-top:8px; width:100%;">Run full scan</button>
            <div class="sleep-hint" id="defenceHint" style="margin-top:6px;">Tip: You can also remove ransomware by paying GS Coin inside WannaCry Sim.</div>
        `;
        const btnRunDefenceScan = document.getElementById('btnRunDefenceScan');
        const defenceStatus = document.getElementById('defenceStatus');
        const defenceHint = document.getElementById('defenceHint');

        btnRunDefenceScan.onclick = () => {
            btnRunDefenceScan.disabled = true;
            btnRunDefenceScan.textContent = 'Scanning...';
            setTimeout(() => {
                if (state.ransomwareActive) {
                    clearRansomware('GS Defence scan');
                    defenceStatus.textContent = 'Threat neutralized: WannaCry Sim removed.';
                    defenceHint.textContent = 'System restored. Your files are unlocked (simulated).';
                } else {
                    showToast('No threats found');
                    logEvent('GS Defence scan: no threats');
                    defenceHint.textContent = 'No active ransomware simulation detected.';
                }
                btnRunDefenceScan.disabled = false;
                btnRunDefenceScan.textContent = 'Run full scan';
            }, 900);
        };
    }

    function renderWannaCrySimApp() {
        if (!state.ransomwareActive) {
            appBody.innerHTML = `
                <div class="app-section-title">WannaCry Sim</div>
                <div class="list-item">
                    <div class="list-item-title">No active ransomware simulation</div>
                    <div class="list-item-sub">Files are currently unlocked.</div>
                </div>
                <button class="btn btn-secondary" id="btnActivateRansom" style="margin-top:8px; width:100%;">Start ransomware simulation</button>
                <div class="sleep-hint">This is a harmless training UI.</div>
            `;
            document.getElementById('btnActivateRansom').onclick = () => {
                state.ransomwareActive = true;
                saveState();
                logEvent('WannaCry Sim activated');
                renderWannaCrySimApp();
            };
            return;
        }

        const ransomPrice = 250;
        appBody.innerHTML = `
            <div class="app-section-title">WannaCry Sim (Training)</div>
            <div style="margin: 10px 0 12px; padding: 10px; border-radius: 10px; border: 1px dashed rgba(255,80,80,0.55); color: #ffaaaa; background: rgba(60,0,0,0.35); text-align:center; font-weight:600; letter-spacing:0.04em; animation: virusBlink 0.6s infinite;">FILES ENCRYPTED (SIMULATED)</div>
            <div class="list-item">
                <div class="list-item-title">Your demo files are locked</div>
                <div class="list-item-sub">Two recovery options are available below.</div>
            </div>
            <button class="btn btn-secondary" id="btnUseAvRecovery" style="margin-top:8px; width:100%;">Use GS Defence (recommended)</button>
            <button class="btn btn-secondary" id="btnPayRansom" style="margin-top:6px; width:100%;">Pay ${ransomPrice} GS Coin</button>
            <div class="sleep-hint" id="ransomHint" style="margin-top:8px;">Wallet: ${state.gsoCoins} GS Coin</div>
        `;

        document.getElementById('btnUseAvRecovery').onclick = () => {
            showToast('Opening GS Defence...');
            logEvent('WannaCry Sim: user chose GS Defence recovery');
            openApp('gsDefence');
        };

        document.getElementById('btnPayRansom').onclick = () => {
            if (state.gsoCoins < ransomPrice) {
                showToast('Not enough GS Coin');
                logEvent('WannaCry Sim: ransom payment failed (insufficient coin)');
                return;
            }
            state.gsoCoins -= ransomPrice;
            clearRansomware('GS Coin payment');
            showToast('Paid ' + ransomPrice + ' GS Coin (simulated)');
            renderWannaCrySimApp();
        };
    }

    function renderVirusPrankApp() {
        appBody.innerHTML = `
            <div class="app-section-title">Fake Virus Simulator</div>
            <div class="list-item" style="border-color: rgba(255,70,70,0.5); background: rgba(180,20,20,0.25);">
                <div class="list-item-title">‚ö†Ô∏è Fake system warning</div>
                <div class="list-item-sub">No real malware exists here. This screen is only a prank animation.</div>
            </div>
            <div style="margin: 10px 0 12px; padding: 10px; border-radius: 10px; border: 1px dashed rgba(255,80,80,0.55); color: #ffaaaa; background: rgba(60,0,0,0.35); text-align:center; font-weight:600; letter-spacing:0.04em; animation: virusBlink 0.6s infinite;">SIMULATED VIRUS DETECTED</div>
            <button class="btn btn-secondary" id="btnRunScan" style="width:100%;">Run fake antivirus scan</button>
            <div class="sleep-hint" id="virusHint">Tap scan to remove the pretend virus.</div>
        `;
        const btnRunScan = document.getElementById('btnRunScan');
        const virusHint = document.getElementById('virusHint');
        btnRunScan.onclick = () => {
            btnRunScan.disabled = true;
            btnRunScan.textContent = 'Scanning...';
            let progress = 0;
            const timer = setInterval(() => {
                progress += 20;
                btnRunScan.textContent = `Scanning... ${progress}%`;
                if (progress >= 100) {
                    clearInterval(timer);
                    btnRunScan.textContent = 'Threat removed (fake)';
                    virusHint.textContent = 'All good. The prank virus has been neutralized.';
                    showToast('Fake virus removed ‚úÖ');
                    logEvent('Virus Prank app: simulated scan complete');
                }
            }, 260);
        };
    }

    function renderSysLogsApp() {
        appBody.innerHTML = `
            <div class="app-section-title">System Logs</div>
            <div class="dev-log-list" id="devLogList"></div>
            <button class="btn btn-secondary" id="btnClearLogs" style="margin-top:6px;">Clear logs</button>
            <div class="sleep-hint">Logs are stored only in this browser session.</div>
        `;
        const list = document.getElementById('devLogList');
        const btnClear = document.getElementById('btnClearLogs');

        function renderLogs() {
            list.innerHTML = '';
            if (state.logs.length === 0) {
                const empty = document.createElement('div');
                empty.className = 'dev-log-item';
                empty.innerHTML = `<span class="dev-log-text">No logs yet. Use the phone to generate events.</span>`;
                list.appendChild(empty);
                return;
            }
            state.logs.forEach(log => {
                const item = document.createElement('div');
                item.className = 'dev-log-item';
                item.innerHTML = `
                    <span class="dev-log-time">${log.time}</span>
                    <span class="dev-log-text">${log.text}</span>
                `;
                list.appendChild(item);
            });
        }

        renderLogs();

        btnClear.onclick = () => {
            state.logs = [];
            saveState();
            renderLogs();
            logEvent('Logs cleared');
        };
    }

    function renderUiTunerApp() {
        appBody.innerHTML = `
            <div class="app-section-title">UI Tuner</div>
            <div class="settings-row">
                <div class="settings-label">Slow animations</div>
                <div class="toggle ${state.devSlowAnimations ? 'on' : ''}" id="toggleSlowAnim"><div class="toggle-knob"></div></div>
            </div>
            <div class="settings-row">
                <div class="settings-label">Layout bounds</div>
                <div class="toggle ${state.devShowBounds ? 'on' : ''}" id="toggleBounds"><div class="toggle-knob"></div></div>
            </div>
            <div class="settings-row">
                <div class="settings-label">Debug flashes</div>
                <div class="toggle ${state.devDebugFlashes ? 'on' : ''}" id="toggleFlashes"><div class="toggle-knob"></div></div>
            </div>
            <div class="sleep-hint">These options affect how the whole UI animates and renders.</div>
        `;
        const toggleSlowAnim = document.getElementById('toggleSlowAnim');
        const toggleBounds = document.getElementById('toggleBounds');
        const toggleFlashes = document.getElementById('toggleFlashes');

        toggleSlowAnim.onclick = () => {
            state.devSlowAnimations = !state.devSlowAnimations;
            toggleSlowAnim.classList.toggle('on', state.devSlowAnimations);
            applyDevOptions();
            saveState();
            logEvent('Dev: slow animations ' + (state.devSlowAnimations ? 'on' : 'off'));
        };
        toggleBounds.onclick = () => {
            state.devShowBounds = !state.devShowBounds;
            toggleBounds.classList.toggle('on', state.devShowBounds);
            applyDevOptions();
            saveState();
            logEvent('Dev: layout bounds ' + (state.devShowBounds ? 'on' : 'off'));
        };
        toggleFlashes.onclick = () => {
            state.devDebugFlashes = !state.devDebugFlashes;
            toggleFlashes.classList.toggle('on', state.devDebugFlashes);
            saveState();
            logEvent('Dev: debug flashes ' + (state.devDebugFlashes ? 'on' : 'off'));
        };
    }

    function renderExperimentsApp() {
        appBody.innerHTML = `
            <div class="app-section-title">Experimental features</div>
            <div class="settings-row">
                <div class="settings-label">FPS overlay</div>
                <div class="toggle ${state.devShowFps ? 'on' : ''}" id="toggleFps"><div class="toggle-knob"></div></div>
            </div>
            <div class="settings-row">
                <div class="settings-label">Touch indicators</div>
                <div class="toggle ${state.devShowTouches ? 'on' : ''}" id="toggleTouches"><div class="toggle-knob"></div></div>
            </div>
            <div class="settings-row">
                <div class="settings-label">CPU meter</div>
                <div class="toggle ${state.devShowCpu ? 'on' : ''}" id="toggleCpu"><div class="toggle-knob"></div></div>
            </div>
            <div class="settings-row">
                <div class="settings-label">Network debug text</div>
                <div class="toggle ${state.devShowNetDebug ? 'on' : ''}" id="toggleNetDebug"><div class="toggle-knob"></div></div>
            </div>
            <div class="sleep-hint">These overlays are visible only while Developer mode is enabled.</div>
        `;
        const toggleFps = document.getElementById('toggleFps');
        const toggleTouches = document.getElementById('toggleTouches');
        const toggleCpu = document.getElementById('toggleCpu');
        const toggleNetDebug = document.getElementById('toggleNetDebug');

        toggleFps.onclick = () => {
            state.devShowFps = !state.devShowFps;
            toggleFps.classList.toggle('on', state.devShowFps);
            applyDevOptions();
            saveState();
            logEvent('Dev: FPS overlay ' + (state.devShowFps ? 'on' : 'off'));
        };
        toggleTouches.onclick = () => {
            state.devShowTouches = !state.devShowTouches;
            toggleTouches.classList.toggle('on', state.devShowTouches);
            saveState();
            logEvent('Dev: touch indicators ' + (state.devShowTouches ? 'on' : 'off'));
        };
        toggleCpu.onclick = () => {
            state.devShowCpu = !state.devShowCpu;
            toggleCpu.classList.toggle('on', state.devShowCpu);
            applyDevOptions();
            saveState();
            logEvent('Dev: CPU meter ' + (state.devShowCpu ? 'on' : 'off'));
        };
        toggleNetDebug.onclick = () => {
            state.devShowNetDebug = !state.devShowNetDebug;
            toggleNetDebug.classList.toggle('on', state.devShowNetDebug);
            applyDevOptions();
            saveState();
            logEvent('Dev: network debug ' + (state.devShowNetDebug ? 'on' : 'off'));
        };
    }

    function applyDevOptions() {
        if (state.devMode && (state.devShowFps || state.devShowCpu || state.devShowNetDebug)) {
            devOverlay.classList.add('visible');
        } else {
            devOverlay.classList.remove('visible');
        }

        if (state.devMode && state.devShowBounds) {
            phoneScreen.classList.add('dev-bounds');
        } else {
            phoneScreen.classList.remove('dev-bounds');
        }

        if (state.devMode && state.devSlowAnimations) {
            phoneScreen.classList.add('dev-slow');
        } else {
            phoneScreen.classList.remove('dev-slow');
        }
    }

    function applyOneUiMode() {
        document.body.classList.toggle('one-ui', !!state.oneUiMode);
        document.body.setAttribute('data-galaxy-theme', state.galaxyTheme || 'oneui-light');
        const inlineSvg = svg => `data:image/svg+xml;utf8,${encodeURIComponent(svg)}`;
        const inlineWallpapers = {
            coral: inlineSvg('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1080 2400" preserveAspectRatio="xMidYMid slice"><defs><linearGradient id="bg" x1="0" y1="0" x2="1" y2="1"><stop offset="0" stop-color="#ff7b6e"/><stop offset="0.5" stop-color="#ff9e8c"/><stop offset="1" stop-color="#ffc7a2"/></linearGradient></defs><rect width="1080" height="2400" fill="url(%23bg)"/><circle cx="220" cy="430" r="260" fill="#ffffff" opacity="0.15"/><circle cx="870" cy="1700" r="380" fill="#ff4f7a" opacity="0.18"/></svg>'),
            mint: inlineSvg('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1080 2400" preserveAspectRatio="xMidYMid slice"><defs><linearGradient id="bg" x1="0" y1="0" x2="1" y2="1"><stop offset="0" stop-color="#0ea67a"/><stop offset="0.5" stop-color="#3ecf9f"/><stop offset="1" stop-color="#95f3d5"/></linearGradient></defs><rect width="1080" height="2400" fill="url(%23bg)"/><circle cx="840" cy="420" r="300" fill="#ffffff" opacity="0.12"/><circle cx="280" cy="1800" r="360" fill="#0a8065" opacity="0.2"/></svg>')
        };
        const map = {
            ocean: 'wallpaper-ocean.svg',
            purple: 'wallpaper-purple.svg',
            dark: 'wallpaper-dark.svg',
            coral: inlineWallpapers.coral,
            mint: inlineWallpapers.mint
        };
        const palette = {
            ocean: ['#1a73e8', '#4ea1ff'],
            purple: ['#7b4dff', '#b084ff'],
            dark: ['#3a465b', '#6f819f'],
            coral: ['#ff6f61', '#ff9a8f'],
            mint: ['#10b981', '#67e8c8']
        };
        const wallpaperKey = map[state.wallpaper] ? state.wallpaper : 'ocean';
        if (wallpaperKey !== state.wallpaper) state.wallpaper = wallpaperKey;
        const wp = map[wallpaperKey] || map.ocean;
        const colorKey = state.colorTheme || wallpaperKey || 'ocean';
        const [accent, accent2] = palette[colorKey] || palette.ocean;
        document.documentElement.style.setProperty('--wallpaper-image', `url('${wp}')`);
        document.documentElement.style.setProperty('--theme-accent', accent);
        document.documentElement.style.setProperty('--theme-accent-2', accent2);
        document.body.classList.toggle('color-ui', !!state.colorTheme);
        const shadeTitle = document.querySelector('.shade-title');
        if (shadeTitle) shadeTitle.textContent = state.oneUiMode ? 'One UI Quick Panel' : 'GSO Quick Panel';
        const powerTitle = document.querySelector('.power-menu-title');
        if (powerTitle) powerTitle.textContent = state.oneUiMode ? 'One UI Power Menu' : 'GSO Power Menu';
        const lockFooter = document.querySelector('.lock-footer');
        if (lockFooter) lockFooter.innerHTML = state.oneUiMode
            ? 'Samsung One UI simulation mode is active.<br>Everything remains safe and simulated.'
            : 'Real time. Real network status. Fake phone.<br>GSO Phone runs entirely in your browser.';
    }

    function initDropdownShade() {
        statusBar.addEventListener('click', () => {
            dropdownShade.classList.add('visible');
        });
        btnShadeClose.addEventListener('click', () => {
            dropdownShade.classList.remove('visible');
        });
        dropdownShade.querySelectorAll('.shade-tile').forEach(tile => {
            tile.addEventListener('click', () => {
                const key = tile.dataset.toggle;
                tile.classList.toggle('active');
                switch (key) {
                    case 'wifi':
                        state.wifiOn = tile.classList.contains('active');
                        logEvent('Quick: Wi‚ÄëFi ' + (state.wifiOn ? 'on' : 'off'));
                        break;
                    case 'bt':
                        state.btOn = tile.classList.contains('active');
                        logEvent('Quick: Bluetooth ' + (state.btOn ? 'on' : 'off'));
                        break;
                    case 'cell':
                        state.cellOn = tile.classList.contains('active');
                        logEvent('Quick: Cellular ' + (state.cellOn ? 'on' : 'off'));
                        break;
                    case 'airplane':
                        state.airplane = tile.classList.contains('active');
                        logEvent('Quick: Airplane ' + (state.airplane ? 'on' : 'off'));
                        break;
                    case 'dnd':
                        state.dnd = tile.classList.contains('active');
                        logEvent('Quick: DND ' + (state.dnd ? 'on' : 'off'));
                        break;
                    case 'hotspot':
                        state.hotspot = tile.classList.contains('active');
                        logEvent('Quick: Hotspot ' + (state.hotspot ? 'on' : 'off'));
                        break;
                    case 'batterySaver':
                        state.batterySaver = tile.classList.contains('active');
                        logEvent('Quick: Battery Saver ' + (state.batterySaver ? 'on' : 'off'));
                        break;
                    case 'devMode':
                        state.devMode = tile.classList.contains('active');
                        logEvent('Quick: Dev mode ' + (state.devMode ? 'on' : 'off'));
                        showToast(state.devMode ? 'Developer mode enabled' : 'Developer mode disabled');
                        if (state.devMode) {
                            pushNotification('Developer mode', 'Quick panel dev mode enabled.');
                        }
                        applyDevOptions();
                        renderApps();
                        break;
                }
                shadeSubtitle.textContent = `Balanced ‚Ä¢ Network: ${state.wifiOn && navigator.onLine ? 'Online' : 'Offline'}`;
                updateBatteryUI();
                saveState();
            });
        });

        brightnessSlider.addEventListener('input', () => {
            state.brightness = parseInt(brightnessSlider.value, 10);
            updateBrightness();
            saveState();
            logEvent('Brightness: ' + state.brightness);
        });

        volumeSlider.addEventListener('input', () => {
            state.volume = parseInt(volumeSlider.value, 10);
            showVolumeOverlay();
            saveState();
            logEvent('Volume slider: ' + state.volume);
        });
    }

    function initButtons() {
        let powerDownTime = 0;
        let powerInterval = null;

        btnPower.addEventListener('mousedown', () => {
            if (!state.poweredOn) return;
            powerDownTime = 0;
            powerInterval = setInterval(() => {
                powerDownTime += 100;
                if (powerDownTime >= 800) {
                    clearInterval(powerInterval);
                    powerInterval = null;
                    showPowerMenu();
                }
            }, 100);
        });

        btnPower.addEventListener('mouseup', () => {
            if (!state.poweredOn) {
                if (state.batteryDead || state.battery <= 0) {
                    showToast('Battery empty. Tap screen to plug charger.');
                    return;
                }
                performBoot();
                return;
            }
            if (powerInterval) {
                clearInterval(powerInterval);
                powerInterval = null;
            }
            if (powerDownTime < 800) {
                if (state.sleeping) {
                    wakePhone();
                } else {
                    sleepPhone();
                }
            }
        });

        btnPower.addEventListener('mouseleave', () => {
            if (powerInterval) {
                clearInterval(powerInterval);
                powerInterval = null;
            }
        });

        btnVolUp.addEventListener('click', () => {
            changeVolume(+10);
        });
        btnVolDown.addEventListener('click', () => {
            changeVolume(-10);
        });

        btnShutdown.onclick = () => {
            performShutdown();
        };
        btnRestart.onclick = () => {
            hidePowerMenu();
            setActiveScreen(bootScreen);
            clearAllIntervals();
            logEvent('System: restart');
            setTimeout(() => {
                lockPhone();
                startIntervals();
            }, 2000);
        };
        btnEmergency.onclick = () => {
            state.emergencyMode = !state.emergencyMode;
            showToast(state.emergencyMode ? 'Emergency mode (fake) enabled' : 'Emergency mode disabled');
            logEvent('Emergency mode: ' + (state.emergencyMode ? 'on' : 'off'));
        };
        btnCancelPower.onclick = hidePowerMenu;

        btnAppBack.onclick = () => {
            goHome();
        };

        btnNavBack.onclick = () => {
            if (state.currentApp) {
                goHome();
            } else if (!state.locked && !homeScreen.classList.contains('active')) {
                goHome();
            } else if (state.locked && !pinEntryPanel.classList.contains('hidden')) {
                hidePasscodeEntry();
            }
        };

        btnNavHome.onclick = () => {
            if (state.locked) {
                hidePasscodeEntry();
                setActiveScreen(lockScreen);
            } else {
                goHome();
            }
        };

        btnRecents.onclick = () => {
            renderRecents();
        };

        sleepOverlay.addEventListener('click', () => {
            if (state.poweredOn) wakePhone();
        });

        btnUnlockPrompt.addEventListener('click', () => {
            showPasscodeEntry();
            showToast('Enter passcode');
        });

        lockScreen.addEventListener('touchstart', e => {
            lockSwipeStartY = e.changedTouches[0].clientY;
        }, { passive: true });

        lockScreen.addEventListener('touchend', e => {
            if (lockSwipeStartY === null) return;
            const endY = e.changedTouches[0].clientY;
            const dy = endY - lockSwipeStartY;
            lockSwipeStartY = null;
            if (dy < -40 && state.locked) {
                showPasscodeEntry();
                showToast('Swipe up detected');
            }
        }, { passive: true });

        shutdownScreen.addEventListener('click', () => {
            if (state.batteryDead) startChargingFromDeadBattery();
        });
    }

    function initPinPad() {
        pinPad.querySelectorAll('.pin-key').forEach(btn => {
            btn.addEventListener('click', () => {
                const key = btn.dataset.key;
                handlePinKey(key);
            });
        });
        btnFingerprintUnlock.style.display = state.fingerprintEnabled ? 'inline-block' : 'none';
        btnFingerprintUnlock.addEventListener('click', () => {
            if (!state.fingerprintEnabled) return showToast('Fingerprint unlock is disabled');
            showToast('Fingerprint recognized');
            unlockPhone();
            logEvent('Security: fingerprint unlock used');
        });
    }

    function initAppLaunch() {
        phoneScreen.addEventListener('click', e => {
            const icon = e.target.closest('.app-icon');
            if (!icon) return;
            const appId = icon.dataset.appId;
            openApp(appId);
        });
    }

    function startIntervals() {
        intervals.push(setInterval(updateTime, 1000));
        intervals.push(setInterval(drainBattery, 20000));
        intervals.push(setInterval(randomNotification, 50000));
    }

    function initDevLoop() {
        function loop(now) {
            const dt = now - fpsLastTime;
            fpsFrames++;
            if (dt >= 1000) {
                fpsValue = Math.round((fpsFrames * 1000) / dt);
                fpsFrames = 0;
                fpsLastTime = now;
                cpuValue = Math.round(20 + Math.random() * 40);
                if (state.devMode && (state.devShowFps || state.devShowCpu || state.devShowNetDebug)) {
                    let fpsText = 'FPS: ' + (state.devShowFps ? fpsValue : '--');
                    let cpuText = 'CPU: ' + (state.devShowCpu ? cpuValue + '%' : '--');
                    devFpsBox.textContent = fpsText + ' ‚Ä¢ ' + cpuText;
                    const ping = 20 + Math.round(Math.random() * 80);
                    const netText = 'Net: ' + (navigator.onLine ? 'Online' : 'Offline');
                    const pingText = state.devShowNetDebug ? 'Ping: ' + ping + 'ms' : 'Ping: --';
                    devNetBox.textContent = netText + ' ‚Ä¢ ' + pingText;
                }
            }
            requestAnimationFrame(loop);
        }
        requestAnimationFrame(loop);
    }

    function initDevTouches() {
        phoneScreen.addEventListener('pointerdown', e => {
            if (!state.devMode || !state.devShowTouches) return;
            const rect = phoneScreen.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const dot = document.createElement('div');
            dot.className = 'dev-touch-indicator';
            dot.style.left = x + 'px';
            dot.style.top = y + 'px';
            phoneScreen.appendChild(dot);
            setTimeout(() => {
                dot.remove();
            }, 400);
        });
    }

    function initHomeSwipe() {
        appGrid.addEventListener('touchstart', e => {
            if (!homeScreen.classList.contains('active')) return;
            homeSwipeStartX = e.changedTouches[0].clientX;
        }, { passive: true });

        appGrid.addEventListener('touchend', e => {
            if (!homeScreen.classList.contains('active') || homeSwipeStartX === null) return;
            const endX = e.changedTouches[0].clientX;
            const dx = endX - homeSwipeStartX;
            homeSwipeStartX = null;
            const threshold = 45;
            const totalIcons = [...apps].filter(a => !a.devOnly || state.devMode).length + storeApps.filter(a => state.storeInstalled[a.id]).length;
            const totalPages = Math.max(1, Math.ceil(totalIcons / APPS_PER_PAGE));

            if (dx < -threshold && state.homePage < totalPages - 1) {
                state.homePage += 1;
                saveState();
                renderApps();
                showToast(`Page ${state.homePage + 1}/${totalPages}`);
            } else if (dx > threshold && state.homePage > 0) {
                state.homePage -= 1;
                saveState();
                renderApps();
                showToast(`Page ${state.homePage + 1}/${totalPages}`);
            }
        }, { passive: true });
    }

    function init() {
        loadState();
        ensureAppOrder();
        renderApps();
        updateTime();
        updateBatteryUI();
        widgetWeatherMain.textContent = state.fakeWeather.toFixed(1) + '¬∞C';
        widgetWeatherSub.textContent = state.fakeWeatherDesc;
        brightnessSlider.value = state.brightness;
        volumeSlider.value = state.volume;
        updateBrightness();
        initDropdownShade();
        initButtons();
        initPinPad();
        initAppLaunch();
        initHomeSwipe();
        initRealWeather();
        initDevLoop();
        initDevTouches();
        applyDevOptions();
        applyOneUiMode();
        applyDarkMode();

        shadeSubtitle.textContent = `Balanced ‚Ä¢ Network: ${navigator.onLine ? 'Online' : 'Offline'}`;
        widgetStatusSub.textContent = `Battery: ${state.battery}% ‚Ä¢ Network: ${navigator.onLine ? 'Online' : 'Offline'}`;

        logEvent('Simulator init');
        if (!state.poweredOn) {
            if (state.batteryDead) {
                updateShutdownStatus('Battery is fully drained (0%).<br>Phone is off.', 'Tap screen to plug in charger.');
            } else {
                updateShutdownStatus('Shutting down GSO Phone‚Ä¶<br>All systems are now offline.', 'Press the power button to boot again.');
            }
            setActiveScreen(shutdownScreen);
        } else {
            setActiveScreen(bootScreen);
            setTimeout(() => {
                lockPhone();
                startIntervals();
            }, 2000);
        }

        window.addEventListener('online', () => {
            widgetStatusSub.textContent = `Battery: ${state.battery}% ‚Ä¢ Network: Online`;
            shadeSubtitle.textContent = 'Balanced ‚Ä¢ Network: Online';
            logEvent('Network: online');
        });
        window.addEventListener('offline', () => {
            widgetStatusSub.textContent = `Battery: ${state.battery}% ‚Ä¢ Network: Offline`;
            shadeSubtitle.textContent = 'Balanced ‚Ä¢ Network: Offline';
            logEvent('Network: offline');
        });
    }

    init();
})();
</script>
</body>
</html>
